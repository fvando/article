\begin{apendicesenv}
\partapendices

\chapter{Formulações Alternativas do Modelo}

\noindent
\textbf{Nota de consistência terminológica.}
Nos apêndices, o termo \emph{tarefa} é utilizado de forma genérica para representar
blocos de trabalho associados a períodos discretizados no modelo principal.
Quando aplicável, a correspondência tarefa $\leftrightarrow$ período é direta,
não implicando perda de generalidade da formulação.

Este apêndice apresenta formulações alternativas e extensões estruturadas a partir
do modelo principal de Programação Linear Inteira (PLI) desenvolvido para o
problema de escalonamento de motoristas profissionais sob o Regulamento (CE)
n.º~561/2006. O objetivo destes modelos complementares é demonstrar a
flexibilidade da abordagem proposta e documentar versões alternativas avaliadas
durante o processo de experimentação.

\section{Modelo com Janelas de Tempo Suaves (Soft Time Windows)}
Nesta formulação, janelas de tempo rígidas para início de turnos foram relaxadas
por meio de penalizações lineares. O objetivo consiste em permitir que o solver
explore soluções mais amplas em cenários de alta restrição, atribuindo custos a
atrasos e adiantamentos. A função objetivo passa a incorporar penalidades
adicionais:

\[
\min\; Z = \sum_{i,j} c_{ij} x_{ij} + \sum_{m} \alpha_m e_m + \sum_{m} \beta_m a_m,
\]

onde $e_m$ representa atraso permitido e $a_m$ adiantamento. Este modelo foi útil
em cenários de sobrecarga operacional.

\section{Modelo com Agrupamento de Motoristas por Categoria}
Em operações reais, empresas segmentam motoristas por categorias: nacional,
internacional, ADR, refrigerado, entre outras. Nesta formulação estendida,
restrições de compatibilidade foram adicionadas:

\[
x_{ij} \leq \text{cat}(i,j)
\]

onde $\text{cat}(i,j)$ é uma matriz binária que define compatibilidade entre categorias e
tarefas. Essa abordagem permitiu analisar impactos da especialização.

\section{Modelo com Múltiplos Períodos (Planeamento Semanal)}
Para planeamento semanal, foi desenvolvido um modelo multi-período com acumulação
de horas por motorista, respeitando limites de direção diários e semanais:

\[
H^\text{sem}_m = \sum_{d \in Dias} H_{m,d} \leq H^\text{max}_\text{sem}.
\]

Esta versão foi particularmente útil nos testes de escalabilidade, permitindo
avaliar desempenho do solver frente a horizontes temporais ampliados.

\section{Modelo com Preferências do Motorista}
Em extensões opcionais, foi testado um modelo com vetores de preferência
(motorista–rota–horário), introduzindo coeficientes de satisfação:

\[
\max \sum_{i,j} s_{ij} x_{ij},
\]

onde $s_{ij}$ representa o nível de preferência. Essa formulação foi útil no
estudo exploratório de equilíbrio entre eficiência e bem-estar do trabalhador.

\bigskip
As variações aqui documentadas constituem parte do processo iterativo de
refinamento do modelo e servem como base para potenciais trabalhos futuros.



\chapter{Cenários de Simulação e Parâmetros Utilizados}

Este apêndice documenta integralmente os cenários experimentais utilizados para
avaliar o modelo de escalonamento, bem como os parâmetros adotados no solver
OR-Tools e restrições específicas aplicadas durante os testes.

\section{Perfis de Simulação (Profiles)}

Os experimentos foram conduzidos utilizando perfis de configuração padronizados, garantindo reprodutibilidade e consistência nas análises de curto e médio prazo.

\begin{itemize}
    \item \textbf{Perfil P2 (STRICT\_24H):}
    Cenário base de 24 horas com 96 períodos de 15 minutos. Ativação rigorosa das restrições de condução diária (9h), pausas obrigatórias (45 min) e repouso diário mínimo (11h). Utilizado para validação fundamental da conformidade legal.

    \item \textbf{Perfil W1 (WEEKLY\_CORE):}
    Horizonte estendido de 7 dias (672 períodos). Incorpora o limite semanal de condução (56h) e o repouso semanal, além das regras diárias recorrentes. Focado na análise de sustentabilidade da escala em ciclos semanais.

    \item \textbf{Perfil B1 (BIWEEKLY\_CORE):}
    Horizonte de 15 dias (1440 períodos). Ativa o conjunto completo de restrições do Regulamento (CE) n.º 561/2006, incluindo o limite quinzenal de condução (90h) e as regras de compensação de repouso. Representa o teste de estresse máximo para o solver.
\end{itemize}

\section{Configurações do Solver (CP-SAT)}

O solver CP-SAT da biblioteca Google OR-Tools foi configurado com parâmetros específicos para equilibrar a exploração do espaço de soluções e o tempo de execução:

\begin{itemize}
    \item \textbf{Solver Engine:} Google OR-Tools CP-SAT (v9.x).
    \item \textbf{Parallel Workers:} 8 threads (paralelismo ativado para busca concorrente).
    \item \textbf{Max Time:}
    \begin{itemize}
        \item 30 segundos para cenários de 24h;
        \item 300 segundos para cenários de 7 dias;
        \item 600 segundos para cenários de 15 dias.
    \end{itemize}
    \item \textbf{Presolve:} Ativado (Standard).
    \item \textbf{Log Search Progress:} Ativado para monitoramento de convergência e gap.
    \item \textbf{Linearization Level:} 1 (ativado para restrições lógicas complexas).
\end{itemize}

O tempo de execução variou entre menos de 5 segundos para o perfil P2 e o limite máximo para o perfil B1, demonstrando a escalabilidade da abordagem.

\section{Restrições Consideradas}
Foram aplicadas integralmente as seguintes exigências:

\begin{itemize}
    \item limite de 9h de condução diária (com variação permitida para 10h)
    \item pausas mínimas de 45 minutos a cada 4h30 de direção
    \item repouso diário regular de 11h ou fracionado em 3h + 9h
    \item controle semanal de horas acumuladas
    \item compatibilidade entre motorista e tarefa
\end{itemize}

% \section{Dados Sintéticos Gerados}
% Para garantir reprodutibilidade, parte dos dados foi sintetizada usando
% procedimentos controlados de geração, incluindo:

% \begin{itemize}
%     \item distribuição normal truncada para durações de tarefas
%     \item distribuição uniforme para janelas de início
%     \item matriz de distâncias obtida a partir de centroides simulados
% \end{itemize}

% Os dados reais utilizados na empresa cliente foram anonimizados e não são
% expostos neste documento por razões de confidencialidade.

% \bigskip
% Os cenários aqui documentados constituem a base experimental para validação,
% desempenho e análise de sensibilidade do modelo de escalonamento proposto.


\chapter{Estrutura de Entradas e Saídas do Solver}

Este apêndice descreve o formato dos dados utilizados no solver OR-Tools e as
estruturas retornadas após a resolução do modelo.

\section{Entradas do Modelo}

\begin{itemize}
    \item \textbf{Matriz de tarefas ($T$):}  
    Contém identificação, duração, janelas de início e compatibilidades.

    \item \textbf{Conjunto de motoristas ($M$):}  
    Inclui categoria, histórico de horas, limites semanais e tipo de operação.

    \item \textbf{Parâmetros regulatórios ($R$):}  
    Conjunto estruturado contendo:
    \begin{itemize}
        \item limites de condução diária e semanal,
        \item regras de pausa,
        \item repousos diários e semanais.
    \end{itemize}

    \item \textbf{Parâmetros do Solver ($S$):}  
    \begin{itemize}
        \item MIP\_gap,
        \item tempo máximo,
        \item níveis de corte,
        \item ativação de heurísticas.
    \end{itemize}
\end{itemize}

\section{Saídas do Modelo}

\begin{itemize}
    \item \textbf{Alocação motorista–tarefa ($x_{ij}=1$):}  
    Indica qual motorista foi designado a cada tarefa.

    \item \textbf{Horas acumuladas:}  
    Relatório do total de horas diárias e semanais por motorista.

    \item \textbf{Verificação de conformidade:}  
    Conjunto de flags apontando violações regulatórias.

    \item \textbf{Valor final da função objetivo ($Z^*$):}  
Valor ótimo ou incumbente final obtido pelo solver, conforme o critério de parada.

    \item \textbf{Relatório temporal:}  
    Tempo de execução do solver, número de nós explorados, cortes aplicados.
\end{itemize}

% \chapter{Processo de Geração de Dados Sintéticos}

% Este apêndice descreve o método empregado para gerar dados sintéticos utilizados
% nos experimentos, garantindo reprodutibilidade e aderência ao comportamento real
% do setor de transporte rodoviário.

% \section{Estratégia de Geração}
% O processo foi dividido em três etapas:

% \subsection*{1. Geração das Tarefas}
% Durations foram amostradas de uma distribuição normal truncada:
% \[
% D \sim \text{Normal}(\mu = 180, \sigma = 40) \quad \text{com} \quad D \in [60, 480].
% \]

% \subsection*{2. Janelas de Tempo}
% Os intervalos de início foram gerados usando distribuição uniforme:
% \[
% S \sim \text{Uniform}(6h, 20h).
% \]

% \subsection*{3. Perfil dos Motoristas}
% Atributos gerados:

% \begin{itemize}
%     \item categoria (Nacional, Internacional, ADR),
%     \item horas acumuladas na semana anterior,
%     \item disponibilidade,
%     \item qualificações específicas.
% \end{itemize}

% \section{Validação dos Dados}
% Foram aplicadas checagens consistentes:

% \begin{itemize}
%     \item nenhuma tarefa ultrapassa o limite diário permitido,
%     \item janelas de tempo não se sobrepõem indevidamente,
%     \item distribuição de categorias aproximada da realidade da empresa.
% \end{itemize}

\chapter{Modelo Matemático Completo}

Este apêndice apresenta a formulação completa do modelo de Programação Linear
Inteira utilizado na dissertação.

\[
X_{d,t} \in \{0, 1, \dots, \text{cap}\}
\]
indicando a carga (número de tarefas) atribuída ao motorista $t$ no período $d$.

\[
Y_{d,t} = 
\begin{cases}
1 & \text{se o motorista } t \text{ está presente no período } d,\\
0 & \text{caso contrário}.
\end{cases}
\]

\[
Z_t = 
\begin{cases}
1 & \text{se o motorista } t \text{ é ativado},\\
0 & \text{caso contrário}.
\end{cases}
\]

\[
L_t: \text{carga total acumulada do motorista } t.
\]

\section{Função Objetivo}


\subsection*{Fase 1: Cobertura e Minimização de Recursos}
\[
\min Z_1 = \alpha \sum_{d \in D} U_d + \beta \sum_{t \in T} Z_t - \gamma \sum_{d \in D} \sum_{t \in T} X_{d,t},
\]
Sujeito às restrições de cobertura e limites legais.

\subsection*{Fase 2: Balanceamento e Suavização (Opcional)}
Após fixar os valores ótimos de $U_d$ e $Z_t$:
\[
\min Z_2 = \omega_1 \sum_{d,t} Y_{d,t} + \omega_2 \sum_{t} \xi_t + \omega_3 L_{\max},
\]
onde $\xi_t$ representa o excesso de carga acima do \textit{soft limit} e $L_{\max}$ é a carga máxima (Makespan).

Os pesos configurados garantem $\alpha \gg \beta \gg \gamma$ e $\omega_1, \omega_2, \omega_3$ definem a preferência de qualidade da escala.

\section{Restrições}

\subsection{Cobertura de Demanda}
\[
\sum_{t \in T} X_{d,t} + U_d = \text{demanda}_d \quad \forall d.
\]

\subsection{Limite de Condução Diária}
\[
\sum_{d \in \text{Dia}} X_{d,t} \le L^{\text{dia}}.
\]

\subsection{Janelas de Tempo}
\[
s_j x_{ij} \ge a_j, \qquad s_j x_{ij} + d_j \le b_j.
\]

\subsection{Compatibilidade Motorista--Tarefa (Opcional)}
\[
X_{d,t} \le \text{cap} \cdot \text{comp}(d,t).
\]

\subsection{Acúmulo Semanal}
\[
\sum_{d \in \text{Semana}} X_{d,t} \le L^{\text{sem}}.
\]

\section{Modelo Final}
Versão consolidada inclui todas as restrições regulatórias (CE 561/2006), limites
de pausa, repouso e condução quinzenal, incorporadas por meio de estruturas
lineares ou restrições complementares.




\chapter{Interface e Instrumentação do Simulador}
\label{cap:interface-simulador}

Este apêndice documenta a interface interativa e a instrumentação analítica do
simulador desenvolvido neste trabalho. A ferramenta, implementada em
\textit{Streamlit}, foi concebida para atuar como uma plataforma experimental
completa, permitindo não apenas a resolução de escalas, mas também o diagnóstico
profundo do comportamento dos algoritmos através de métricas automatizadas.

\section{Interface de Operação e Configuração}

As figuras a seguir ilustram os módulos principais de interação com o usuário,
responsáveis pela parametrização da demanda e configuração das estratégias de
otimização.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{template/figuras/simulator_new.png}
    \caption{Interface principal: entrada de dados de demanda e seleção de algoritmos.}
    \label{fig:interface-simulator}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{template/figuras/input-restriction_new.png}
    \caption{Configuração do modelo: ativação de restrições do Regulamento (CE) 561/2006.}
    \label{fig:config-simulator}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{template/figuras/results_new.png}
    \caption{Resultados e Diagnóstico: indicadores de performance e complexidade do modelo resolvido.}
    \label{fig:results-simulator}
\end{figure}

\section{Resultados Comparativos e Desempenho (Cenário 24h)}

Para validar a eficácia dos diferentes algoritmos implementados, o simulador realiza uma análise comparativa automática entre os modos Heurístico, Matheurístico (LNS) e Exato (MILP).

\input{template/figuras/results_table_auto.tex}

A Figura~\ref{fig:radar-comparativo} apresenta uma comparação multidimensional dos KPIs alcançados por cada modo, destacando as trocas (\textit{trade-offs}) entre o tempo de execução e a qualidade da solução (cobertura e eficiência).

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{template/figuras/kpi_comparativo_radar_auto.png}
    \caption{Radar Comparativo: avaliação multidimensional de desempenho entre os modos Heurístico, LNS e Exato (Cenário 24h).}
    \label{fig:radar-comparativo}
\end{figure}

\section{Configuração de Restrições e Parâmetros}

A Tabela~\ref{tab:config_restricoes_auto} detalha as restrições fisiológicas e legais selecionadas para os experimentos reportados nesta seção, garantindo a reprodutibilidade dos resultados.

\input{template/figuras/constraints_table_auto.tex}

\section{Análise de Convergência (Módulo LNS)}

O simulador fornece visualizações detalhadas do processo de busca matheurística,
permitindo avaliar a evolução da função objetivo e o histórico de melhorias
encontradas pelo método \textit{Large Neighborhood Search}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{template/figuras/convergencia_auto.png}
    \caption{Gráfico de Convergência: evolução do valor da função objetivo ao longo das iterações do LNS (gerado via instrumentação automática).}
    \label{fig:conv-lns}
\end{figure}

\section{Análise Estrutural da Matriz de Restrições}

Uma das contribuições originais deste trabalho é o módulo de análise algébrica,
que permite visualizar a densidade e a estrutura da matriz de restrições gerada
pelo modelo, facilitando a identificação de acoplamentos temporais.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{template/figuras/matriz_restricao_auto.png}
    \caption{Matriz de Restrições: visualização da esparsidade e do acoplamento das regras de condução e repouso.}
    \label{fig:matrix-diag}
\end{figure}

\section{Heatmaps Analíticos e KPIs}

Para suporte à decisão operacional, o simulador gera mapas de calor que facilitam
a identificação de padrões de cobertura e margem de segurança ao longo de todo o
horizonte de planejamento.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{template/figuras/kpi_coverage_auto.png}
        \caption{Heatmap de Cobertura.}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{template/figuras/kpi_safety_auto.png}
        \caption{Margem de Segurança.}
    \end{subfigure}
    \caption{Diagnóstico Slot-a-Slot: visualização cromática do atendimento da demanda e excesso/déficit de capacidade.}
    \label{fig:heatmaps-analiticos}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{template/figuras/kpi_radar_auto.png}
    \caption{Radar de Desempenho: Comparação multidimensional de KPIs (Estabilidade, Risco, Custo e Cobertura).}
    \label{fig:radar-panel}
\end{figure}

\end{apendicesenv}


