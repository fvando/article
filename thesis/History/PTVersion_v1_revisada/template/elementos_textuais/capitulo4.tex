\chapter{Metodologia}\label{capitulo4}

\section{Introdução}

Este capítulo descreve a abordagem metodológica adotada para o desenvolvimento do modelo de Programa{\c c}{\~a}o Linear Inteira (PLI) aplicado ao escalonamento de motoristas sob o Regulamento (CE) n.{\textordmasculine} 561/2006. A metodologia combina rigor matemático, técnicas de Pesquisa Operacional e ferramentas computacionais modernas, garantindo reprodutibilidade, precisão e aplicabilidade prática.  A pesquisa pode ser classificada como:
\begin{itemize}
    \item \textbf{Aplicada}: pois aborda um problema concreto do setor de transporte rodoviário.
    \item \textbf{Quantitativa}: devido ao uso de modelagem matemática e experimentação.
    \item \textbf{Metodológica}: por propor um artefato científico (o modelo ILP).
    \item \textbf{Experimental}: pela realização de testes controlados em cen{\'a}rios variados.
\end{itemize}

Essa abordagem está alinhada aos fundamentos apresentados no \cite{hillier2015}, \cite{taha2017}, \cite{nemhauser1988}, bem como ao trabalho aplicado apresentado em \cite{moreira2025}.

\section{Estrutura Geral da Pesquisa}

A metodologia foi organizada em cinco macroetapas, ilustradas a seguir:

\begin{enumerate}
    \item Estudo da legislação europeia e identificação das restrições operacionais;
    \item Formulação completa do modelo matemático;
    \item Implementação computacional utilizando Python e OR-Tools;
    \item Definição de cen{\'a}rios e experimentos;
    \item Análise dos resultados e verificação da conformidade legal.
\end{enumerate}

Cada etapa é detalhada nas seções seguintes.

\section{Etapa 1: Estudo da Legislação Europeia}

Nesta etapa, foi realizada uma análise minuciosa dos documentos legais que regem a jornada dos motoristas profissionais na Uni{\~a}o Europeia, incluindo:

\begin{itemize}
    \item \textit{Regulamento (CE) n.{\textordmasculine} 561/2006};
    \item \textit{Diretiva 2002/15/CE};
    \item \textit{Regulamento (UE) n.{\textordmasculine} 165/2014}.
\end{itemize}

As restrições extraídas desses documentos foram traduzidas em condições formais, como:
\begin{itemize}
    \item limites de condu{\c c}{\~a}o diária, semanal e quinzenal;
    \item pausas obrigatórias;
    \item descanso diário normal ou reduzido;
    \item descanso semanal;
    \item regras de continuidade temporal.
\end{itemize}

O desafio principal foi converter regras textuais em inequações lineares, conforme discutido em \cite{pillai2019} e explorado experimentalmente em \cite{moreira2025}.

\section{Etapa 2: Formulação Matemática}

Com base nos requisitos legais e operacionais, o problema foi formalizado como um modelo de Programa{\c c}{\~a}o Linear Inteira (PLI). Os principais elementos definidos foram:

\begin{itemize}
    \item conjuntos (motoristas, per{\'\i}odos, janelas temporais);
    \item vari{\'a}veis de decisão (alocação, descanso, início de jornada, condução acumulada);
    \item parâmetros (demanda, limites legais, duração dos períodos);
    \item função objetivo (minimização lexicográfica do número de motoristas ativos e, em caso de empate, do número total de períodos alocados);
    \item restrições (legais e operacionais).
\end{itemize}

A função objetivo é estruturada de forma lexicográfica. O critério primário consiste na minimização do número de motoristas ativos ao longo do horizonte de planejamento. Em caso de soluções equivalentes sob esse critério, adota-se como critério secundário a minimização do esforço operacional total, mensurado pelo número de períodos alocados. Essa hierarquização reflete de maneira mais fiel os objetivos operacionais do transporte rodoviário, priorizando a redução do número de recursos humanos mobilizados antes da otimização fina da carga de trabalho.

A formulação foi construída com base em técnicas clássicas de otimização combinatoria \cite{nemhauser1988}, \cite{dantzig1963}, mas adaptada ao contexto legislativo europeu. O modelo final é apresentado em detalhes no Capítulo~4, incluindo linearizações e implicações lógicas.

\section{Etapa 3: Implementação Computacional}

A implementação foi realizada em Python, com uso do solver CP-SAT do s \cite{googleORTools}. Essa etapa envolveu:

\begin{itemize}
    \item criação programática das vari{\'a}veis do modelo;
    \item construção da matriz de restrições;
    \item aplicação das regras legais e dos vínculos sequenciais;
    \item configuração de parâmetros do solver (limites de tempo, cortes, heur{\'\i}sticas);
    \item desenvolvimento de uma interface interativa em Streamlit;
    \item geração automática de relat{\'o}rios, gráficos e indicadores operacionais.
\end{itemize}

A linguagem Python facilitou o uso de estruturas de dados eficientes, como arraNumys \cite{numpyDocs} e \cite{tabelPpandasDocs}, além de permitir modularidade na construção do modelo.

\section{Etapa 4: Definição dos Cenários Experimentais}

Quatro tipos de cen{\'a}rio foram definidos para validação:

\begin{itemize}
    \item \textbf{24 horas}: cenário básico, discretizado em 96 períodos de 15 minutos, utilizado para validação das restrições diárias de condução, pausas e início de jornada.
    \item \textbf{7 dias}: cenário compacto, útil para validar a recorrência das restrições diárias ao longo de múltiplos ciclos consecutivos.
    \item \textbf{15 dias}: cenário intermediário, crítico para a avaliação de restrições quinzenais e efeitos acumulativos de carga de trabalho.
    \item \textbf{30 dias}: cenário de escala real, empregado para testar a robustez temporal do modelo e sua aplicabilidade em horizontes de planejamento prolongados.
\end{itemize}

% Cada cen{\'a}rio utilizou uma curva de demanda variável, simulando altas e baixas operacionais típicas do setor.

Os dados utilizados na definição das curvas de demanda e dos cenários experimentais são oriundos de registros operacionais reais de uma empresa do setor de transporte rodoviário. Por razões de confidencialidade, os dados foram previamente anonimizados e agregados, preservando-se apenas as características temporais e estruturais necessárias à modelagem.

A granularidade temporal adotada, correspondente a períodos de 15 minutos, reflete a frequência com que pedidos de carga são efetivamente recebidos e registrados nos sistemas operacionais da empresa. Cada período representa, portanto, um intervalo de tempo no qual novas demandas podem surgir e ser contabilizadas no respectivo \emph{slot} temporal, permitindo capturar de forma fiel a dinâmica operacional observada na prática.


Parâmetros como duração de períodos, restrições legais e tamanho da força de trabalho foram configuráveis via interface.

Embora múltiplos cenários experimentais tenham sido avaliados, a apresentação gráfica detalhada de todos os casos resultaria em um volume excessivo de artefatos visuais, sem ganho proporcional de poder explicativo. Dessa forma, optou-se por apresentar de forma detalhada apenas o cenário de 24 horas, que permite uma análise clara e intuitiva do comportamento do modelo e dos métodos de resolução. Os demais cenários são analisados por meio de métricas agregadas e comparativas, evidenciando a consistência e a escalabilidade dos resultados.

\section{Etapa 5: Análise dos Resultados}

Após a execução do solver, foram analisados:

% \begin{itemize}
%     \item conformidade legal (restrições diárias, semanais e quinzenais);
%     \item cobertura da demanda por período;
%     \item sobrecarga e subutilização;
%     \item estabilidade temporal da alocação;
%     \item tempo computacional e qualidade da solução;
%     \item impacto da estrutura matricial no desempenho do solver.
% \end{itemize}

% A avaliação baseou-se em indicadores estatísticos e gráficos, discutidos no Capítulo~6.

% \section{Performance and Robustness Indicators}

% The following indicators are used to evaluate the quality, robustness, and operational feasibility of the workforce allocation solution.

\begin{description}

\item[\textbf{Estabilidade de Cobertura ($\sigma$)}]  
\textit{Standard deviation of coverage levels across time slots.}  

Mede a variabilidade da cobertura ao longo dos períodos de tempo. Valores baixos indicam uma alocação estável e homogênea, enquanto valores elevados revelam flutuações significativas entre excesso e falta de cobertura, caracterizando menor robustez temporal.

\item[\textbf{Slots com Déficit de Demanda}]  
\textit{Number of time slots where allocated workers are fewer than required demand.}  

Representa a quantidade de períodos em que a demanda não é totalmente atendida. Esse indicador reflete diretamente falhas operacionais e potenciais violações do nível de serviço.

\item[\textbf{Demanda Total Não Atendida}]  
\textit{Total amount of unmet demand aggregated over all time slots.}  

Quantifica o volume total de demanda não coberta ao longo do horizonte de planejamento. Diferentemente do número de slots deficitários, este indicador mede a magnitude acumulada do déficit.

\item[\textbf{Índice Global de Cobertura}]  
\textit{Overall ratio between allocated capacity and required demand.}  

Avalia o nível médio de atendimento do sistema. Valores próximos de $1.0$ indicam equilíbrio entre oferta e demanda; valores inferiores indicam subalocação, enquanto valores superiores sugerem excesso estrutural de capacidade.

\item[\textbf{Gravidade do Risco}]  
\textit{Weighted severity score based on uncovered demand and its distribution over time.}  

Consolida a intensidade, duração e distribuição temporal dos déficits de cobertura em um único índice, permitindo classificar a solução em níveis de risco operacional.

\item[\textbf{Eficiência da Força de Trabalho}]  
\textit{Ratio between productive allocated work and total available workforce capacity.}  

Indica o grau de utilização efetiva da capacidade total dos trabalhadores. Alta eficiência sugere baixo nível de ociosidade, enquanto valores reduzidos indicam superdimensionamento ou má distribuição dos recursos.

\item[\textbf{Custo Estimado}]  
\textit{Estimated operational cost derived from workforce allocation and penalty terms.}  

Representa o custo total da solução, considerando horas trabalhadas, penalidades por déficit ou excesso e demais componentes definidos na função objetivo do modelo.

\item[\textbf{Estabilidade Temporal}]  
\textit{Consistency of workforce allocation patterns over consecutive time slots.}  

Avalia a suavidade das transições na alocação ao longo do tempo. Soluções com alta estabilidade reduzem mudanças abruptas, simplificando a execução operacional e aumentando a previsibilidade.

\item[\textbf{Capacidade em Excesso}]  
\textit{Total amount of allocated capacity exceeding the required demand.}  

Mede o desperdício de recursos decorrente da superalocação. Este indicador é fundamental para analisar o trade-off entre robustez da solução e eficiência econômica.

\end{description}


\section{Considerações Finais}

A metodologia adotada assegura:

\begin{itemize}
    \item rigor na formulação matemática;
    \item confiabilidade na execução computacional;
    \item flexibilidade para análise de cen{\'a}rios;
    \item reprodutibilidade científica.
\end{itemize}

O fluxo metodológico permite integrar legislação, modelagem e computação, resultando em uma solução robusta e aplicável para operações reais no setor de transporte rodoviário europeu.

\subsection{Abordagem heurística e matheurística proposta}

O simulador desenvolvido permite a execução do modelo de escalonamento por meio de três modos distintos de resolução, selecionáveis pelo usuário: \textit{Exato}, \textit{Heurístico} e \textit{Large Neighborhood Search (LNS)}. Cada modo corresponde a uma estratégia de resolução específica, mantendo-se inalterada a formulação matemática do problema.

No modo \textit{Exato}, o problema é resolvido integralmente por meio de um solver de programação inteira, visando a obtenção da solução ótima global, sujeito às limitações computacionais inerentes a problemas de grande escala. O modo \textit{Heurístico} emprega uma estratégia construtiva gulosa, capaz de produzir soluções viáveis de forma rápida, servindo tanto como solução inicial quanto como referência para análises comparativas. Já o modo \textit{LNS} combina a solução heurística inicial com ciclos iterativos de destruição e reconstrução parcial, utilizando modelos MILP locais para refinar progressivamente a solução.


Embora o modelo de programação inteira mista (MILP) formulado neste trabalho permita obter soluções ótimas para instâncias de porte moderado, a sua aplicação direta em cenários de grande escala (muitos motoristas, múltiplos dias e diferentes perfis de demanda) pode tornar-se computacionalmente onerosa. Além disso, em ambientes operacionais dinâmicos, como o transporte rodoviário de mercadorias, nem sempre é necessário obter a solução ótima global; muitas vezes, soluções de boa qualidade obtidas em tempos reduzidos são preferíveis.

Com esse contexto, propõe-se uma abordagem em três camadas: (i) uma heurística construtiva para gerar uma escala inicial factível, (ii) uma matheurística do tipo \textit{Large Neighborhood Search} (LNS), em que subproblemas são resolvidos exatamente pelo modelo MILP/CP-SAT, e (iii) um módulo de apoio baseado em aprendizagem de máquina (\textit{machine learning}) para guiar a seleção de vizinhanças promissoras e refinar decisões locais de alocação.

A heurística construtiva opera em uma linha do tempo discretizada (intervalos de 15 minutos) e, para cada período, atribui motoristas elegíveis de forma gulosa, respeitando as principais restrições regulatórias (condução contínua máxima, pausas mínimas, descanso diário e semanal, limites semanais e quinzenais). Esta fase produz rapidamente uma solução inicial factível, ainda que potencialmente distante do ótimo.

Na segunda camada, aplica-se uma matheurística LNS: a solução corrente é parcialmente destruída em sub-regiões (por exemplo, um dia específico, um subconjunto de motoristas ou janelas temporais críticas com sobrecarga de demanda), e um subproblema restrito é reotimizado com o modelo MILP proposto, sob limite de tempo. Assim, o modelo exato deixa de atuar sobre toda a instância e passa a ser utilizado como um \textit{oráculo} de melhoria local, combinando a robustez de soluções exatas com a flexibilidade exploratória típica de heurísticas.

Por fim, a terceira camada explora técnicas de aprendizagem de máquina para apoiar a heurística e a matheurística. A partir de instâncias menores, nas quais o MILP consegue atingir a solução ótima em tempo aceitável, constroem-se conjuntos de dados que relacionam padrões de alocação (por motorista, por período e por janela temporal) à qualidade da solução. Modelos supervisionados podem então ser treinados para: (a) atribuir escores de preferência a pares motorista-período, auxiliando a etapa construtiva, e (b) estimar a probabilidade de melhoria ao selecionar determinadas vizinhanças na LNS, priorizando regiões da solução com maior potencial de ganho.

Essa arquitetura híbrida (MILP + heurística + LNS + ML) permite, por um lado, preservar o rigor e a completude do modelo regulatório desenvolvido e, por outro, oferecer tempos de resposta compatíveis com o uso em sistemas de apoio à decisão em contexto real, seja em ambiente acadêmico (simulações) ou em produto (como no contexto da plataforma Ottimizia).

\subsubsection{Heurística construtiva para geração de escala inicial}

A seguir apresenta-se a heurística construtiva proposta para geração de uma escala inicial factível.

\begin{algorithm}[H]
\caption{Heurística construtiva para escalonamento de motoristas}
\label{alg:heuristica_construtiva}
\DontPrintSemicolon
\KwIn{
    Conjunto de motoristas $D$; \\
    Conjunto de períodos discretizados $T$ (intervalos de 15 minutos); \\
    Demanda de motoristas por período $\mathrm{dem}(t)$; \\
    Parâmetros regulatórios (limites de condução e trabalho, pausas e descansos).
}
\KwOut{
    Escala inicial $y_{d,t} \in \{0,1\}$ indicando se o motorista $d$ trabalha no período $t$.
}

Inicializar $y_{d,t} \gets 0$, para todo $d \in D$, $t \in T$\;
Inicializar o estado de cada motorista $d$ (tempo de condução acumulado, tempo de trabalho no dia, semana etc.)\;

\ForEach{$t \in T$ em ordem cronológica}{
    calcular $k \gets$ número de motoristas já alocados em $t$\;
    \If{$k \ge \mathrm{dem}(t)$}{
        \textbf{continuar} para o próximo período\;
    }
    determinar conjunto de candidatos elegíveis $C_t \subseteq D$ tais que, se escalados em $t$, não violam nenhuma restrição regulatória (condução máxima, pausa mínima, descanso diário/sem. etc.)\;
    \While{$k < \mathrm{dem}(t)$ \textbf{e} $C_t \neq \emptyset$}{
        \ForEach{$d \in C_t$}{
            calcular um escore heurístico $\mathrm{score}(d,t)$, por exemplo:
            \begin{itemize}
                \item menor carga de trabalho acumulada na semana;
                \item menor número de dias consecutivos trabalhados;
                \item proximidade de completar um bloco consistente de trabalho ou condução.
            \end{itemize}
        }
        selecionar $d^\star \in C_t$ com maior $\mathrm{score}(d^\star,t)$\;
        definir $y_{d^\star,t} \gets 1$\;
        atualizar o estado regulatório de $d^\star$ (tempo de condução contínua, total diário, semanal etc.)\;
        remover $d^\star$ de $C_t$\;
        atualizar $k \gets k + 1$\;
    }
    \If{$k < \mathrm{dem}(t)$}{
        marcar o período $t$ como \textit{crítico} (demanda não atendida) para uso posterior na LNS\;
    }
}

\ForEach{$d \in D$}{
    pós-processar a escala de $d$ para inserir explicitamente blocos de pausa e descanso, caso ainda não tenham sido definidos de forma clara, garantindo conformidade regulatória final\;
}

\Return{$y_{d,t}$}\;
\end{algorithm}

\subsubsection{Matheurística LNS baseada em MILP}

A heurística construtiva gera uma solução inicial $y$. Para melhorar essa solução, propõe-se uma matheurística do tipo \textit{Large Neighborhood Search} (LNS), na qual partes da escala são destruídas e reotimizadas por meio do modelo MILP.

\begin{algorithm}[H]
\caption{LNS matheurística para melhoria da escala}
\label{alg:lns_matheuristica}
\DontPrintSemicolon
\KwIn{
    Solução inicial $y$ (escala factível); \\
    Conjunto de motoristas $D$, períodos $T$ e demais parâmetros; \\
    Número máximo de iterações $\mathrm{it}_{\max}$; \\
    Tempo máximo de resolução do subproblema MILP $t_{\max}^{\text{MILP}}$.
}
\KwOut{
    Solução melhorada $y^{\text{best}}$.
}

Definir função objetivo $F(y)$ (por exemplo, número de motoristas utilizados, soma de horas extras, penalizações por slots não atendidos etc.)\;
Inicializar $y^{\text{curr}} \gets y$ e $y^{\text{best}} \gets y$\;

\For{$\mathrm{it} = 1$ \KwTo $\mathrm{it}_{\max}$}{
    selecionar um tipo de vizinhança $V$ (por exemplo: dia, subconjunto de motoristas, janela crítica)\;
    
    \eIf{$V =$ ``dia''}{
        escolher um dia $d_{\text{dia}}$ e definir subconjunto de períodos $T_V \subset T$ correspondentes a esse dia\;
        definir subconjunto de motoristas $D_V \gets D$ (todos os motoristas são candidatos para aquele dia)\;
    }{
        \If{$V =$ ``motoristas''}{
            escolher subconjunto de motoristas $D_V \subset D$ (por exemplo, os mais sobrecarregados)\;
            definir subconjunto de períodos $T_V \gets T$ (todos os períodos)\;
        }
        \If{$V =$ ``janela crítica''}{
            selecionar subconjunto de períodos $T_V \subset T$ com slots não atendidos ou muito próximos a violações\;
            definir subconjunto de motoristas $D_V \subset D$ que atuam em $T_V$\;
        }
    }
    
    construir subproblema MILP restrito a $D_V$ e $T_V$:
    \begin{itemize}
        \item variáveis de decisão $y_{d,t}$ apenas para $d \in D_V$, $t \in T_V$;
        \item manter fixas todas as demais decisões de $y^{\text{curr}}$ fora da vizinhança;
        \item preservar todas as restrições regulatórias (diárias, semanais, quinzenais);
        \item respeitar consistência com a solução fixa (por exemplo, limites semanais acumulados).
    \end{itemize}
    
    resolver o subproblema MILP com limite de tempo $t_{\max}^{\text{MILP}}$, obtendo uma solução local $y^{V}$ (se viável)\;
    
    \If{foi encontrada solução viável $y^{V}$}{
        construir uma solução candidata $y^{\text{cand}}$ substituindo, em $y^{\text{curr}}$, as decisões de $D_V \times T_V$ pelas provenientes de $y^{V}$\;
        \If{$F(y^{\text{cand}}) < F(y^{\text{curr}})$}{
            atualizar $y^{\text{curr}} \gets y^{\text{cand}}$\;
            \If{$F(y^{\text{curr}}) < F(y^{\text{best}})$}{
                atualizar $y^{\text{best}} \gets y^{\text{curr}}$\;
            }
        }
    }
}

\Return{$y^{\text{best}}$}\;
\end{algorithm}

\subsubsection{Integração com aprendizagem de máquina}

Para potencializar a eficiência da LNS, propõe-se o uso de modelos de aprendizagem de máquina para guiar a seleção de vizinhanças e priorizar regiões da solução com maior potencial de melhoria.

\begin{algorithm}[H]
\caption{Esquema geral de integração com aprendizagem de máquina}
\label{alg:ml_guided_lns}
\DontPrintSemicolon
\KwIn{
    Conjunto de instâncias de treinamento; \\
    Soluções ótimas (ou de alta qualidade) obtidas via MILP em instâncias menores; \\
    Heurística construtiva e LNS descritas anteriormente.
}
\KwOut{
    Modelo de ML para apoio à decisão na LNS.
}

\textbf{Fase offline (treinamento)}:\;
\ForEach{instância de treinamento}{
    resolver o MILP até a otimalidade ou até um limite de tempo elevado, obtendo solução de referência $y^{\star}$\;
    gerar solução heurística $y^{H}$ (via heurística construtiva)\;
    extrair \textit{features} por período, motorista e janelas temporais (por exemplo: carga acumulada, folgas, distância até limites regulatórios, presença de slots não atendidos)\;
    rotular:
    \begin{itemize}
        \item pares $(d,t)$ como bons/ruins com base na diferença entre $y^{H}$ e $y^{\star}$;
        \item vizinhanças (conjuntos de períodos/motoristas) como promissoras se sua reotimização aproxima $y^{H}$ de $y^{\star}$.
    \end{itemize}
}
treinar modelos supervisionados (por exemplo, gradiente reforçado ou \textit{gradient boosting}) para:
\begin{itemize}
    \item $f_1(d,t) \to$ estimar a qualidade de atribuir o motorista $d$ ao período $t$;
    \item $f_2(V) \to$ estimar o ganho esperado de reotimizar uma vizinhança $V$.
\end{itemize}

\textbf{Fase online (uso na LNS)}:\;
Na heurística construtiva, utilizar $f_1$ como componente do escore $\mathrm{score}(d,t)$\;
Na LNS, ao selecionar vizinhanças, avaliar múltiplas opções $V_1,\dots,V_k$ e priorizar aquelas com maior $f_2(V_i)$\;

\Return{modelos $f_1$ e $f_2$ integrados ao processo heurístico}\;
\end{algorithm}

% ============================================================
% SEÇÃO DE METODOLOGIA — INTEGRAÇÃO COM OS INDICADORES DO SIMULADOR
% ============================================================

\section{Metodologia de Avaliação}
\label{sec:metodologia-avaliacao}

A avaliação das soluções geradas pelos métodos implementados no simulador
--- Programação Inteira (exato), heurística construtiva e método matheurístico LNS ---
baseia-se em um conjunto estruturado de indicadores quantitativos, gráficos analíticos
e métricas consolidadas na literatura de scheduling e otimização combinatória
\cite{pinedo2016scheduling}, \cite{talbi2009metaheuristics}, \cite{papadimitriou1998combinatorial}, \cite{santamaria2025driver}.

Cada indicador descrito nesta seção contribui para a análise multidimensional de desempenho,
permitindo verificar simultaneamente: qualidade da solução, estabilidade temporal, segurança operacional,
eficiência de cobertura e custo computacional.

As subseções seguintes descrevem formalmente cada métrica, acompanhadas de suas figuras correspondentes.

% ============================================================
% \subsection{Demanda por Período}
% \label{subsec:demanda-periodo}

% A curva de demanda representa o número de motoristas requeridos em cada intervalo de tempo.
% Esse gráfico caracteriza a carga operacional e estabelece a referência mínima de cobertura esperada.

% \begin{figure}[H]
%     \centering
%     %\includegraphics[width=\textwidth]{fig/demanda_periodo.pdf}
%     \caption{Demanda operacional por período.}
%     \label{fig:demanda-periodo}
% \end{figure}

% Picos de demanda visíveis na \autoref{fig:demanda-periodo}
% implicam maior pressão sobre o algoritmo, enquanto períodos de baixa carga
% permitem redistribuição estratégica de motoristas.

% % ============================================================
% \subsection{Escalonamento Gerado (Driver Scheduling)}
% \label{subsec:driver-scheduling}

% O gráfico da solução detalha a quantidade de motoristas alocados por período pelo modelo de otimização.

% \begin{figure}[H]
%     \centering
%     %\includegraphics[width=\textwidth]{fig/driver_scheduling.pdf}
%     \caption{Motoristas alocados por período na solução gerada.}
%     \label{fig:driver-scheduling}
% \end{figure}

% Comparações entre demanda (Figura~\ref{fig:demanda-periodo})
% e solução (Figura~\ref{fig:driver-scheduling})
% apontam aderência, excesso ou déficit operacional.

% % ============================================================
% \subsection{Taxa de Cobertura}
% \label{subsec:coverage-rate}

% A taxa de cobertura \(Coverage_t\) é definida como:

% \[
% Coverage_t = \frac{\text{Motoristas}_t}{Demanda_t}.
% \]

% \begin{figure}[H]
%     \centering
%     %\includegraphics[width=\textwidth]{fig/coverage_rate.pdf}
%     \caption{Taxa de cobertura por período.}
%     \label{fig:coverage-rate}
% \end{figure}

% Valores próximos de 1 indicam aderência adequada, enquanto valores inferiores apontam risco operacional.
% A \autoref{fig:coverage-rate} sintetiza esse comportamento visualmente.

% % ============================================================
% \subsection{Índice de Sobrecarga}
% \label{subsec:overload-index}

% O índice de sobrecarga é dado por:

% \[
% Overload_t = 
% \frac{
%     \max(0, \text{Motoristas}_t - Demanda_t)
% }{
%     Demanda_t
% }.
% \]

% \begin{figure}[H]
%     \centering
%     %\includegraphics[width=\textwidth]{fig/overload_index.pdf}
%     \caption{Índice de sobrecarga por período.}
%     \label{fig:overload-index}
% \end{figure}

% A \autoref{fig:overload-index} evidencia janelas nas quais há superdimensionamento da escala.

% % ============================================================
% \subsection{Índice de Subutilização}
% \label{subsec:underload-index}

% Definido por:

% \[
% Underload_t = 
% \frac{
%     \max(0, Demanda_t - \text{Motoristas}_t)
% }{
%     \text{Motoristas}_t
% }.
% \]

% \begin{figure}[H]
%     \centering
%     %\includegraphics[width=\textwidth]{fig/underload_index.pdf}
%     \caption{Índice de subutilização por período.}
%     \label{fig:underload-index}
% \end{figure}

% A \autoref{fig:underload-index} mostra períodos de déficit,
% fundamentais para análise de risco operacional.

% % ============================================================
% \subsection{Mapa de Calor de Cobertura}
% \label{subsec:coverage-heatmap}

% \begin{figure}[H]
%     \centering
%     % \includegraphics[width=\textwidth]{fig/coverage_heatmap.pdf}
%     \caption{Mapa de calor de cobertura por período.}
%     \label{fig:coverage-heatmap}
% \end{figure}

% Esse mapa facilita a identificação de padrões estruturais, como clusters de subcobertura.

% % ============================================================
% \subsection{Mapa de Calor da Margem de Segurança}
% \label{subsec:safety-margin}

% \begin{figure}[H]
%     \centering
%     % \includegraphics[width=\textwidth]{fig/safety_margin_heatmap.pdf}
%     \caption{Mapa de calor da margem de segurança operacional.}
%     \label{fig:safety-margin}
% \end{figure}

% A \autoref{fig:safety-margin} destaca períodos críticos associados a déficit ou superávit operacional.

% % ============================================================
% \subsection{Convergência do LNS}
% \label{subsec:lns-convergence}

% \begin{figure}[H]
%     \centering
%     % \includegraphics[width=\textwidth]{fig/lns_convergence.pdf}
%     \caption{Evolução da função objetivo nas iterações do LNS.}
%     \label{fig:lns-convergence}
% \end{figure}

% Esse gráfico é fundamental para demonstrar o comportamento da matheurística,
% evidenciando melhora progressiva ou estagnação.

% % ============================================================
% \subsection{Relaxação do LNS}
% \label{subsec:lns-relaxation}

% \begin{figure}[H]
%     \centering
%     % \includegraphics[width=\textwidth]{fig/lns_relaxation.pdf}
%     \caption{Nível de relaxação aplicado ao longo das iterações do LNS.}
%     \label{fig:lns-relaxation}
% \end{figure}

% Valores elevados sugerem exploração ampla;
% valores menores refletem intensificação.

% % ============================================================
% \subsection{Comparação entre Modos: Exato, Heurístico e LNS}
% \label{subsec:radar-chart}

% \begin{figure}[H]
%     \centering
%     % \includegraphics[width=\textwidth]{fig/radar_comparison.pdf}
%     \caption{Comparação entre os modos de solução (Exato, Heurístico e LNS).}
%     \label{fig:radar-comparison}
% \end{figure}

% O radar da \autoref{fig:radar-comparison} sintetiza várias métricas,
% permitindo comparar os métodos em estabilidade, custo, aderência e eficiência.

% % ============================================================
% \subsection{Matriz de Restrições (Antes e Depois das Operações)}
% \label{subsec:constraint-matrices}

% \begin{figure}[H]
%     \centering
%     % \includegraphics[width=\textwidth]{fig/initial_constraint_matrix.pdf}
%     \caption{Matriz inicial de restrições.}
%     \label{fig:initial-constraints}
% \end{figure}

% \begin{figure}[H]
%     \centering
%     % \includegraphics[width=\textwidth]{fig/final_constraint_matrix.pdf}
%     \caption{Matriz final após transformações.}
%     \label{fig:final-constraints}
% \end{figure}

% Comparar as Figuras~\ref{fig:initial-constraints} e \ref{fig:final-constraints}
% revela o impacto direto das operações elementares sobre a densidade e estrutura do modelo.

\subsection{Resultados Computacionais — Método Exato}
\label{subsec:resultados-Exato}

Esta subseção apresenta os resultados obtidos por meio do método exato, fundamentado na resolução direta do modelo matemático de otimização. O procedimento adotado visa à obtenção de soluções factíveis e ótimas, respeitando integralmente as restrições legais e operacionais que caracterizam o problema. Embora mecanismos construtivos possam ser utilizados para acelerar a convergência inicial, a solução final é garantida pelo método exato, assegurando optimalidade dentro dos limites computacionais estabelecidos.

Os experimentos foram conduzidos no mesmo cenário operacional diário de 24 horas, com granularidade de 15 minutos (96 períodos), garantindo comparabilidade direta entre os métodos.

\subsubsection{Indicadores Globais de Desempenho}
\label{subsubsec:kpi-heuristic-exact}

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/kpi_exact.png}
\caption{Painel consolidado de indicadores globais (KPIs) da solução exata no cenário de 24 horas.}
\label{fig:kpi-exact}
\end{figure}

\subsection{Atendimento da Demanda e Utilização da Capacidade}
\label{subsec:demanda-capacidade-exact}

A Figura~\ref{fig:demanda-capacidade-exact} ilustra a relação entre demanda solicitada, capacidade alocada, atendimento efetivo e taxa de utilização da capacidade ao longo dos 96 períodos de planejamento.

Observa-se que, nos períodos iniciais, o modelo mantém uma capacidade alocada significativamente superior à demanda, criando margens operacionais capazes de absorver flutuações e incertezas. A partir de determinado ponto do horizonte, nota-se uma redução progressiva da capacidade, acompanhando a queda da demanda e refletindo a racionalização do uso dos motoristas.

Os déficits pontuais identificados concentram-se em períodos de menor impacto sistêmico, reforçando que o modelo prioriza a eficiência global em detrimento de uma cobertura uniforme ao longo de todo o horizonte. Essa estratégia é coerente com o objetivo de minimizar a utilização de recursos humanos sob restrições legais rigorosas.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/demanda_capacidade_exact.png}
\caption{Demanda, capacidade alocada, atendimento efetivo e taxa de utilização da capacidade por período — método exato.}
\label{fig:demanda-capacidade-exact}
\end{figure}

\subsection{Distribuição do Esforço Operacional}
\label{subsec:esforco-operacional-exact}

A análise do esforço operacional é apresentada na Figura~\ref{fig:esforco-exact}, por meio de um painel composto que inclui a função de distribuição acumulada empírica (ECDF), o boxplot da carga de trabalho e a curva de Lorenz, permitindo avaliar a equidade da solução obtida.

Os resultados indicam que a carga média por motorista é aproximadamente 10 horas, com mediana de 9,25 horas, permanecendo dentro de limites compatíveis com a regulamentação europeia vigente. O índice de Gini igual a 0,057 revela uma distribuição altamente equilibrada do esforço entre os motoristas ativos, evidenciando que o modelo não concentra excessivamente a carga de trabalho em subconjuntos específicos.

Esse equilíbrio não é imposto explicitamente pela função objetivo, mas emerge naturalmente da combinação entre restrições legais, estrutura da demanda e características do horizonte de planejamento, reforçando a robustez do método exato.

\begin{figure}[H]
\centering
\includegraphics[width=0.95\textwidth]{template/figuras/esforco_operacional_exact.png}
\caption{Distribuição do esforço operacional dos motoristas ativos — ECDF, boxplot e curva de Lorenz.}
\label{fig:esforco-exact}
\end{figure}

\subsection{Estrutura da Solução e Padrão de Alocação}
\label{subsec:mapa-alocacao-binaria-exact}

A Figura~\ref{fig:mapa-alocacao-binaria-exact} apresenta um recorte do mapa de alocação binária, no qual cada linha representa um motorista e cada coluna corresponde a um período de 15 minutos.

O padrão visual evidencia blocos contínuos de alocação, compatíveis com janelas de trabalho legalmente permitidas, intercalados por períodos de inatividade que respeitam pausas obrigatórias e limites máximos de condução. A ausência de fragmentação excessiva indica que o modelo produz escalonamentos estruturalmente coerentes e operacionalmente viáveis.

Esse tipo de visualização é particularmente relevante para validar a aderência entre a formulação matemática e o comportamento concreto da solução, além de servir como base conceitual para os mecanismos de destruição e reconstrução empregados posteriormente no método \textit{Large Neighborhood Search} (LNS).

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/mapa_alocacao_binaria_exact.png}
\caption{Mapa de alocação binária (recorte) da solução exata no cenário de 24 horas.}
\label{fig:mapa-alocacao-binaria-exact}
\end{figure}

\subsection{Considerações Parciais sobre o Método Exato}
\label{subsec:consideracoes-exact}

Os resultados apresentados demonstram que o método exato é capaz de produzir soluções ótimas, equilibrando atendimento da demanda, eficiência operacional e conformidade regulatória. Contudo, o custo computacional associado, evidenciado pelo tempo de resolução e pela dimensão do modelo, limita sua aplicabilidade direta em cenários de maior escala temporal ou com maior número de motoristas.

Essas observações motivam a introdução dos métodos heurístico e LNS, discutidos nas seções subsequentes, que buscam preservar a qualidade das soluções obtidas pelo método exato ao mesmo tempo em que reduzem significativamente o esforço computacional.

\subsection{Resultados Computacionais — Método Heurístico}
\label{subsec:resultados-heuristico}

Esta subseção apresenta os resultados obtidos com o método heurístico construtivo, baseado em uma estratégia gulosa (\textit{greedy allocation}), cujo objetivo principal é gerar soluções viáveis de forma rápida, respeitando as restrições legais e operacionais fundamentais do problema.

Diferentemente do método exato, o algoritmo heurístico não realiza busca global por otimalidade, sendo utilizado como mecanismo inicial de alocação e como referência de desempenho para métodos mais sofisticados, como o \textit{Large Neighborhood Search} (LNS).

Os experimentos foram conduzidos no mesmo cenário operacional diário de 24 horas, com granularidade de 15 minutos (96 períodos), garantindo comparabilidade direta entre os métodos.

\subsubsection{Indicadores Globais de Desempenho}
\label{subsubsec:kpi-heuristic}

A Figura~\ref{fig:kpi-heuristic} apresenta o painel consolidado de indicadores da solução obtida pelo método heurístico.

Observa-se que o modelo alcança cobertura global de 100\%, com todos os períodos plenamente atendidos e ausência de déficit de demanda. Esse comportamento decorre da natureza conservadora da heurística, que tende a superdimensionar a capacidade alocada para garantir viabilidade imediata.

O \textit{Global Coverage Score} igual a $1.0$ e a inexistência de risco operacional indicam elevada robustez do ponto de vista de atendimento, porém à custa de menor eficiência no uso de recursos, conforme evidenciado nas análises subsequentes.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/kpi_heuristic.png}
\caption{Painel consolidado de indicadores globais (KPIs) da solução heurística.}
\label{fig:kpi-heuristic}
\end{figure}

\subsubsection{Atendimento da Demanda e Utilização da Capacidade}
\label{subsubsec:demanda-capacidade-heuristic}

A Figura~\ref{fig:demanda-capacidade-heuristic} ilustra a relação entre demanda solicitada, capacidade alocada e atendimento efetivo ao longo dos períodos de planejamento.

Nota-se que a capacidade alocada permanece consistentemente superior à demanda, independentemente das variações temporais. Essa característica reflete o objetivo implícito do método heurístico: evitar qualquer violação de cobertura, mesmo que isso implique alocação excedente de motoristas.

Como consequência, a taxa de utilização da capacidade permanece relativamente baixa, evidenciando que o método heurístico privilegia segurança operacional em detrimento da eficiência global, o que é aceitável e esperado neste estágio inicial do pipeline de otimização.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/demanda_capacidade_heuristic.png}
\caption{Demanda, capacidade alocada e atendimento efetivo por período — método heurístico.}
\label{fig:demanda-capacidade-heuristic}
\end{figure}

\subsubsection{Distribuição do Esforço Operacional}
\label{subsubsec:esforco-heuristic}

A Figura~\ref{fig:esforco-heuristic} apresenta a distribuição do esforço operacional entre os motoristas ativos.

Os resultados indicam uma carga média de aproximadamente 11 horas por motorista, com baixa dispersão, sugerindo um padrão de alocação relativamente homogêneo. O índice de Gini obtido é reduzido, indicando boa equidade na distribuição do trabalho, embora com níveis médios de carga superiores aos observados no método exato.

Esse comportamento é consistente com a estratégia do algoritmo, que prioriza o preenchimento sequencial da demanda, sem mecanismos explícitos de redistribuição ou otimização fina da carga de trabalho.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/esforco_operacional_heuristic.png}
\caption{Distribuição do esforço operacional dos motoristas ativos — método heurístico.}
\label{fig:esforco-heuristic}
\end{figure}

\subsubsection{Estrutura da Solução Heurística}
\label{subsubsec:mapa-alocacao-heuristic}

O mapa de alocação binária apresentado na Figura~\ref{fig:mapa-alocacao-binaria-heuristic} evidencia um padrão de alocação mais fragmentado quando comparado ao método exato.

Observam-se múltiplos blocos curtos de atividade distribuídos ao longo do horizonte, resultado direto da lógica gulosa de preenchimento por período. Embora tal estrutura seja viável do ponto de vista legal, ela pode gerar soluções menos desejáveis em termos de estabilidade operacional e continuidade de turnos.

Essa característica reforça o papel do método heurístico como solução inicial, adequada para alimentar processos de refinamento e melhoria incremental, como o método LNS.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/mapa_alocacao_binaria_heuristic.png}
\caption{Mapa de alocação binária (recorte) da solução heurística.}
\label{fig:mapa-alocacao-binaria-heuristic}
\end{figure}

\subsubsection{Considerações Parciais sobre o Método Heurístico}
\label{subsubsec:consideracoes-heuristic}

Os resultados demonstram que o método heurístico é altamente eficaz na geração rápida de soluções viáveis, garantindo cobertura total da demanda e conformidade regulatória básica.

Entretanto, a ausência de mecanismos explícitos de otimização resulta em uso excessivo de capacidade, menor eficiência global e estruturas de alocação menos estáveis. Essas limitações justificam sua utilização como etapa inicial do pipeline de otimização, servindo como ponto de partida para métodos mais avançados, em especial o \textit{Large Neighborhood Search} (LNS), discutido na subseção seguinte.

\subsection{Resultados Computacionais — Large Neighborhood Search (LNS)}
\label{subsec:resultados-lns}

Esta subseção apresenta os resultados obtidos com o método \textit{Large Neighborhood Search} (LNS), empregado como etapa intermediária entre a heurística construtiva e o modelo exato.

O LNS atua sobre uma solução inicial viável, gerada pelo método heurístico, promovendo destruições controladas em blocos temporais e reconstruções locais via modelos MILP restritos. Esse mecanismo permite melhorar progressivamente a qualidade da solução sem incorrer no custo computacional associado a uma otimização global completa.

Os experimentos foram conduzidos no mesmo cenário operacional diário de 24 horas, com granularidade de 15 minutos (96 períodos), garantindo comparabilidade direta com os métodos apresentados anteriormente.

\subsubsection{Indicadores Globais de Desempenho}
\label{subsubsec:kpi-lns}

A Figura~\ref{fig:kpi-lns} apresenta o painel consolidado de indicadores da solução obtida após a aplicação do LNS.

Observa-se que o método mantém cobertura total da demanda (100\%), assim como a heurística construtiva, porém com melhor equilíbrio entre eficiência operacional e controle de risco. O \textit{Global Coverage Score} permanece igual a $1.0$, enquanto o nível de risco se mantém controlado, refletindo a capacidade do LNS de aprimorar a solução sem comprometer sua viabilidade.

O número total de motoristas ativos permanece inalterado, indicando que os ganhos obtidos pelo LNS decorrem principalmente de uma redistribuição temporal mais eficiente da carga de trabalho, e não da ampliação da força de trabalho.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/kpi_lns.png}
\caption{Painel consolidado de indicadores globais (KPIs) da solução obtida pelo método LNS.}
\label{fig:kpi-lns}
\end{figure}

\subsubsection{Atendimento da Demanda e Utilização da Capacidade}
\label{subsubsec:demanda-capacidade-lns}

A Figura~\ref{fig:demanda-capacidade-lns} apresenta a relação entre demanda solicitada, capacidade alocada e atendimento efetivo após a aplicação do LNS.

Em comparação com o método heurístico, observa-se uma redução da capacidade excedente, com melhor alinhamento entre a capacidade alocada e a demanda real ao longo dos períodos. Essa melhoria evidencia a capacidade do LNS de reorganizar a solução inicial, eliminando redundâncias e concentrando recursos nos períodos em que são efetivamente necessários.

Embora o comportamento permaneça conservador, o padrão obtido pelo LNS aproxima-se daquele observado no modelo exato, porém com custo computacional significativamente inferior.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/demanda_capacidade_lns.png}
\caption{Demanda, capacidade alocada e atendimento efetivo por período — método LNS.}
\label{fig:demanda-capacidade-lns}
\end{figure}

\subsubsection{Distribuição do Esforço Operacional}
\label{subsubsec:esforco-lns}

A Figura~\ref{fig:esforco-lns} ilustra a distribuição do esforço operacional entre os motoristas ativos após a aplicação do LNS.

Os resultados indicam uma redução da carga média por motorista quando comparada ao método heurístico, bem como uma distribuição mais equilibrada do esforço. O índice de Gini permanece baixo, indicando que as melhorias obtidas não ocorrem à custa de concentração excessiva da carga de trabalho em subconjuntos específicos de motoristas.

Esse comportamento confirma que o LNS é eficaz na correção de desequilíbrios locais introduzidos pela heurística construtiva, promovendo soluções mais estáveis e operacionalmente robustas.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/esforco_operacional_lns.png}
\caption{Distribuição do esforço operacional dos motoristas ativos — método LNS.}
\label{fig:esforco-lns}
\end{figure}

\subsubsection{Estrutura da Solução Após Refinamento}
\label{subsubsec:mapa-alocacao-lns}

O mapa de alocação binária apresentado na Figura~\ref{fig:mapa-alocacao-lns} evidencia uma estrutura mais organizada e contínua quando comparada à solução heurística inicial.

Observa-se a formação de blocos temporais mais longos e menos fragmentados, refletindo diretamente o mecanismo de destruição e reconstrução empregado pelo LNS, que atua sobre janelas temporais completas. Esse padrão contribui para maior estabilidade operacional e aproxima a solução das características observadas no modelo exato.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{template/figuras/mapa_alocacao_binaria_lns.png}
\caption{Mapa de alocação binária (recorte) da solução refinada pelo método LNS.}
\label{fig:mapa-alocacao-lns}
\end{figure}

\subsubsection{Considerações Parciais sobre o Método LNS}
\label{subsubsec:consideracoes-lns}

Os resultados obtidos demonstram que o método LNS desempenha um papel fundamental no pipeline de otimização proposto, atuando como um mecanismo de equilíbrio entre qualidade da solução e esforço computacional.

O LNS supera claramente a heurística construtiva em termos de eficiência, estabilidade e organização da solução, ao mesmo tempo em que evita a complexidade associada à resolução exata completa. Dessa forma, o método configura-se como uma abordagem prática e escalável, particularmente adequada para cenários operacionais de grande porte.

Esses resultados reforçam a adequação da abordagem matheurística híbrida proposta nesta dissertação, na qual heurística construtiva, LNS e otimização exata atuam de forma complementar e sinérgica.

Com o objetivo de sintetizar e consolidar as diferenças observadas entre os métodos avaliados, a Tabela~\ref{tab:comparacao-metodos} apresenta uma comparação qualitativa entre as abordagens Exata, Heurística e \textit{Large Neighborhood Search} (LNS) no cenário operacional de 24 horas.

A análise considera critérios relevantes sob as perspectivas operacional e computacional, incluindo cobertura da demanda, eficiência no uso da capacidade, distribuição do esforço entre motoristas, fragmentação da alocação, tempo computacional e escalabilidade temporal. Esses critérios permitem avaliar não apenas a qualidade das soluções em termos de atendimento, mas também sua viabilidade prática em contextos reais de planejamento.

A comparação evidencia os trade-offs inerentes a cada abordagem. Enquanto o método exato fornece soluções analiticamente ótimas, sua aplicabilidade é limitada pelo elevado custo computacional. Em contrapartida, a heurística construtiva prioriza rapidez e viabilidade operacional imediata, ao custo de menor eficiência. O método LNS posiciona-se como uma alternativa intermediária, combinando elevada qualidade operacional com esforço computacional controlado, reforçando sua adequação para aplicações em larga escala.


\begin{table}[H]
\centering
\caption{Comparação entre os métodos Exact, Heuristic e LNS no cenário de 24 horas.}
\label{tab:comparacao-metodos}
\begin{tabular}{lccc}
\toprule
\textbf{Critério} & \textbf{Exact} & \textbf{Heuristic} & \textbf{LNS} \\
\midrule
Cobertura Global da Demanda & Alta ($\approx 95\%$) & Total (100\%) & Total (100\%) \\
Déficit de Demanda & Pontual & Nenhum & Nenhum \\
Número de Motoristas & Mínimo & Elevado & Intermediário \\
Eficiência de Capacidade & Alta & Baixa & Média-Alta \\
Distribuição do Esforço & Muito equilibrada & Equilibrada & Equilibrada \\
Fragmentação da Alocação & Baixa & Alta & Moderada \\
Tempo Computacional & Elevado & Muito baixo & Moderado \\
Escalabilidade Temporal & Limitada & Alta & Alta \\
Robustez Operacional & Média & Alta & Alta \\
Adequação Operacional & Analítica & Operacional & Operacional-Otimizada \\
\bottomrule
\end{tabular}
\end{table}
