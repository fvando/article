import streamlit as st

# Default Language
DEFAULT_LANG = "en"

# Translation Dictionary
TRANSLATIONS = {
    "en": {
        # AUTH
        "auth_title": "Restricted Access",
        "auth_desc": "Enter your credentials to access the simulator.",
        "auth_user": "Username",
        "auth_pass": "Password",
        "auth_error": "üòï User not known or password incorrect",
        "auth_restricted": "üîê Restricted Access",
        
        # MAIN
        "app_title": "Driver Allocation Simulator",
        "sidebar_nav": "Navigation",

        # UI / COMMON
        "loading_opt": "‚è≥ Optimization in progress... Please wait.",
        "run_opt": "Run Optimization",
        "global_params": "Global Parameters",
        "algo_params": "Algorithm Parameters",
        
        # SIMULATION - HEADERS
        "sim_title": "Simulation & Optimization",
        "sect_kpis": "KPIs & Metrics",
        "sect_charts": "Charts",
        "sect_logs": "Solver Logs",
        
        # SIMULATION - INPUTS
        "lbl_horizon": "Planning Horizon (Hours)",
        "lbl_slot": "Slot Duration (min)",
        "lbl_drivers": "Number of Drivers (0 = No limit)",
        "lbl_obj": "Objective Function",
        "lbl_symmetry": "Enable Symmetry Breaking (Slower, cleaner)",
        "lbl_time": "Max Time (s)",
        "lbl_opt_mode": "Optimization Mode",
        "lbl_params": "Parameters",
        "lbl_mode_select": "Mode Select:",
        "lbl_lns_iter": "Max LNS Iterations",
        "lbl_max_assign": "Maximize Assignment (Robustness)",
        "lbl_elem_ops": "Elementary Operations",
        "lbl_profile_section": "Profile",
        "lbl_select_profile": "Select a reference profile (optional)",
        "sim_main_title": "Simulator",
        
        # GLOBAL PARAMS COLUMNS
        "col_global": "Global",
        "col_algo": "Algorithm",
        "col_iter": "Iterations | Relaxation",
        "col_drivers": "Drivers / Demands",
        
        # INPUT LABELS
        "lbl_tolerance": "Tolerance Coverage",
        "lbl_variable": "Variable Type",
        "lbl_solver": "GLOP-LP | SCIP-MIP",
        "lbl_density": "Acceptable Density",
        "lbl_limit_iter": "Limit Iterations",
        "lbl_relax": "Relaxation Level",
        "lbl_penalty": "Penalty for Unmet Demand",
        "lbl_cap": "Max Tasks per Driver/Slot",
        "lbl_set_val": "Set Values",
        "lbl_slot_demand": "Slot Demand Input",
        "lbl_total_demand": "Total Demand Loaded",
        
        # OBJECTIVES & RESTRICTIONS
        "lbl_obj_strat": "Select Objective Strategy",
        "lbl_breakdown": "Breakdown",
        "lbl_lex_struct": "Lexicographic Objective Structure",
        "lbl_restr": "Restrictions",
        "lbl_break_opt": "Break Options",
        
        # CACHE & ML
        "lbl_cache": "Cache / Persistence",
        "lbl_update_file": "Update Constraint File",
        "lbl_ml_mode": "Machine Learning Mode",
        "lbl_ml_train": "Machine Learning ‚Äì Training",
        "lbl_ml_desc": "Training models LightGBM (f1 & f2)",
        "btn_train_ml": "Train ML Models",
        
        # ML MESSAGES & INPUTS
        "ml_train_success_f1": "Model f1 successfully trained!",
        "ml_train_fail_f1": "Model f1 was not trained.",
        "ml_train_success_f2": "Model f2 successfully trained!",
        "ml_train_fail_f2": "Model f2 was not trained.",
        "ml_acc": "Accuracy:",
        "ml_mse": "MSE:",
        "ml_na": "not available.",
        "ml_reason": "Reason not given.",
        "ml_rows_used": "Rows used:",
        "ml_model_saved": "Model saved in:",
        "ml_res_f1_title": "üìå Model f‚ÇÅ (Assignment)",
        "ml_res_f2_title": "üìå Model f‚ÇÇ (Neighborhood Ranking)",
        "ml_training_start": "Starting model training... this may take a few minutes.",
        "ml_training_progress": "Training f1 and f2 models...",
        "ml_training_done": "Training completed!",

        "ml_training_error": "Error during training:",
        
        # ML TRAINER MESSAGES
        "ml_err_lgbm_missing": "LightGBM is not installed in the environment.",
        "ml_err_dataset_missing": "Dataset {0} not found at: {1}. Generate it first.",
        "ml_err_dataset_read": "Error reading dataset {0}: {1}",
        "ml_err_dataset_empty": "Dataset {0} is empty. No rows to train.",
        "ml_err_no_label": "Dataset {0} has no '{1}' column.",
        "ml_err_no_features": "Dataset {0} has no compatible feature columns (expected: {1}).",
        "ml_warn_low_data": "Dataset {0} has few rows ({1}). Model might be weak.",
        "ml_msg_loaded": "Dataset {0} loaded ({1} rows).",
        "ml_msg_train_success": "Training completed successfully.",
        "ml_err_train": "Error training LightGBM {0}: {1}",
        "ml_err_acc": "Error calculating accuracy for {0}: {1}",
        "ml_err_mse": "Error calculating MSE for {0}: {1}",
        "ml_err_save": "Error saving model {0} at {1}: {2}",

        "lbl_num_instances": "Number of instances",
        "lbl_periods_per_inst": "Periods per instance",
        "lbl_drivers_limit": "Drivers (limit)",
        "lbl_max_periods_driver": "Maximum number of periods per driver",
        "lbl_min_demand": "Minimum demand per period",
        "lbl_max_demand": "Maximum demand per period",
        "lbl_seed": "Random seed",
        "lbl_f1_desc": "- f‚ÇÅ ‚Üí Driver selection model ‚Äì period",
        "lbl_f2_desc": "- f‚ÇÇ ‚Üí Neighborhood assessment model for LNS",
        "lbl_dataset_note": "Note: Small instances are recommended for resolving (Exact). (E.g., 24 periods and 10 drivers).",
        "btn_gen_dataset": "Generate ML Dataset (f1 & f2)",
        
        "msg_gen_inst": "Generating instance {0} of {1}...",
        "msg_solver_error": "Instance {0}: error solving (Exact) -> {1}",
        "msg_solver_invalid": "Instance {0}: solver did not return valid matrix.",
        "msg_norm_fail": "Instance {0}: normalization failed. Ignored.",
        "msg_dataset_success": "Datasets generated successfully!",
        "ml_gen_done": "Done!",
        "ml_gen_success_detail": "Datasets generated successfully!\n\n- f‚ÇÅ: {0} lines ‚Üí {1}\n- f‚ÇÇ: {2} lines ‚Üí {3}",
        "ml_dataset_folder": "Datasets folder:",
        "lbl_ml_dataset": "Machine Learning ‚Äì Dataset Builder",
        "lbl_gen_dataset": "Generate Training Datasets",
        
        # OPTIONS
        "opt_integer": "Integer",
        "opt_binary": "Binary",
        "opt_continuous": "Continuous",
        "opt_exact": "Exact",
        "opt_heuristic": "Heuristic",
        "opt_lns": "LNS (Large Neighborhood Search)",
        "opt_none": "None",
        "opt_45_min": "45 minutes",
        "opt_15_30": "15+30 split",
        "opt_30_15": "30+15 split",
        
        # MATH TERMS
        "math_unmet_penalty": "Unmet Demand Penalty",
        "math_unmet_desc": "Absolute priority: penalizes unmet demand.",
        "math_active_penalty": "Active Drivers Penalty",
        "math_active_desc": "Minimizes the number of active drivers.",
        "math_task_reward": "Task Reward",
        
        # INTERPRETER & ENGINE
        "interp_title": "Interpretation of the Result",
        "interp_op_eff": "Operational Efficiency",
        "interp_model_struct": "Model Structure",
        "interp_solver_behavior": "Solver Behavior",
        "interp_service_quality": "Service Level / Quality",
        "interp_op_effort": "Operational Effort",
        "interp_no_effort": "No operational effort recorded (0 active drivers).",
        "interp_effort_caption": "Active drivers: **{0}**\nAverage effort: **{1:.2f} h**\nMedian: **{2:.2f} h**\nP90 / P95: **{3:.2f} h / {4:.2f} h**\nGini Index: **{5:.3f}**\n\n‚ö†Ô∏è The panel displays **aggregated operational effort** indicators.\nThe 9h reference is indicative and does not, in isolation,\nrepresent direct verification of legal compliance.",

        # ENGINE MESSAGES
        "eng_err_interp": "Error interpreting results.",
        "eng_opt_proven": "Optimal solution proven (gap ‚â§ 1%).",
        "eng_opt_likely": "Solution with proof of optimality by solver criteria (gap ~ {0:.2f}% if available).",
        "eng_feasible": "Feasible solution found, without proof of optimality.",
        "eng_infeasible": "Model infeasible with current restrictions.",
        "eng_unknown": "Solver state not identified in summary.",
        "eng_heuristic_state": "Heuristic solution (Greedy) - generated without solver.",
        "eng_opt_likely": "Solution with proof of optimality by solver criteria (gap ~ {0:.2f}% if available).",
        "eng_feasible": "Feasible solution found, without proof of optimality.",
        "eng_infeasible": "Model infeasible with current restrictions.",
        "eng_unknown": "Solver state not identified in summary.",
        
        "eng_gap_none": "Gap not reported; evaluate via operational metrics and constraint consistency.",
        "eng_gap_high": "Gap {0:.2f}% (high): considerable improvement might be possible with more time.",
        "eng_gap_mod": "Gap {0:.2f}% (moderate): acceptable in operation, but refineable.",
        "eng_gap_low": "Gap {0:.2f}% (low): very good solution.",
        
        "eng_model_desc": "Mixed Integer Programming (MIP) model with binary allocation variables Y[d,t] and driver activation variables Z[t].",
        "eng_constr_active": "Total active constraints in the model: {0}.",
        "eng_bnb_desc": "The solver used a Branch-and-Bound algorithm with linear relaxations and internal heuristics.",
        "eng_opt_reached": "The solver reached proven optimality.",
        "math_task_desc": "Encourages higher utilization of active drivers.",
        "math_presence_min": "Presence Minimization",
        "math_presence_desc": "Reduces unnecessary presence time.",
        "math_overload": "Overload Balancing",
        "math_overload_desc": "Balances excessive workload per driver.",
        "math_smoothing": "Maximum Load Smoothing",
        "math_smoothing_desc": "Avoids load concentration on a single driver.",
        "math_minimize_drivers": "Minimize Total Number of Drivers",
        "math_role_primary": "Primary (Phase 1)",
        "math_role_secondary": "Secondary (Phase 1)",
        "math_role_tie": "Tie-breaker",
        "math_role_phase2": "Phase 2",

        # RESTRICTIONS & PROFILES
        "restr_cov_desc": "Coverage Need",
        "restr_cov_det": "The number of allocated workers must satisfy the minimum need for period i.",
        "restr_daily_desc": "Daily Driving Limit",
        "restr_daily_det": "Could be 40 periods (10h) twice a week.",
        "restr_break45_desc": "Break 45min After 4.5h Also",
        "restr_break45_det": "After max 18 periods (4.5h), there must be a break of 3 periods (45 min).",
        "restr_rest_daily_desc": "Minimum Daily Rest",
        "restr_rest_daily_det": "The driver must rest at least 44 periods (11h) every day.",
        "restr_rest_weekly_desc": "Weekly Rest",
        "restr_rest_weekly_det": "The driver must have a rest period of 180 periods (45h) every week.",
        "restr_rest_after_work_desc": "Rest after 6 days of work",
        "restr_rest_after_work_det": "Weekly rest must be enjoyed after six consecutive days of work.",
        "restr_weekly_limit_desc": "Weekly Driving Limit",
        "restr_weekly_limit_det": "Total work periods during a week must not exceed 224 periods (56h).",
        "restr_biweekly_limit_desc": "Biweekly Driving Limit",
        "restr_biweekly_limit_det": "Total work periods in two weeks must not exceed 360 periods (90h).",
        "restr_rest_reduced_desc": "Reduced Daily Rest",
        "restr_rest_reduced_det": "Rest may be reduced to 36 periods (9h), but not more than 3 times in 14 days.",
        "restr_rest_biweekly_desc": "Biweekly Rest",
        "restr_rest_biweekly_det": "The driver must have a rest period of 96 periods (24h) every two weeks.",
        
        # PROFILES
        "prof_sanity": "Model validation (coverage + charts, no legal rules)",
        "prof_operational": "Daily Operational EU (core)",
        "prof_strict": "Rigid Daily Operational (minimum rest)",
        "prof_flex": "Flexible Daily Operational (reduced rest allowed)",
        "prof_weekly_core": "Weekly Planning (weekly limit)",
        "prof_weekly_strict": "Rigid Weekly Planning (weekly rest)",
        "prof_biweekly": "Biweekly Planning (Full Regulation)",
        "prof_high_demand": "High Demand (Aggressive Penalty)",
        "prof_low_cost": "Low Cost (Accepts gaps to save drivers)",
        
        # DATASET TABLES
        "col_period": "Period",
        "col_worker": "Driver",
        "col_need": "Need",
        "col_allocated": "Allocated",
        "col_worker_load": "Driver Load",
        "col_gap": "Demand Gap",
        "col_label": "Label",
        "col_total_demand": "Total Demand",
        "col_total_alloc": "Total Allocated",
        "col_uncovered": "Uncovered",
        "col_avg_load": "Avg Load",
        "col_var_load": "Load Variance",
        "col_global_cov": "Global Coverage",
        "col_efficiency": "Efficiency",
        "col_risk": "Operational Risk",
        "col_stability": "Stability",
        "lbl_preview_f1": "Preview f1 (Assignment):",
        "lbl_preview_f2": "Preview f2 (Neighborhood):",
        
        # LEX OBJECTIVES
        "lex_unmet": "Unmet Demand Minimization",
        "lex_unmet_desc": "Absolute priority: maximize coverage.",
        "lex_driver_min": "Driver Minimization",
        "lex_driver_desc": "Minimize the number of active drivers.",
        "lex_util": "Utilization Tie-breaker",
        "lex_util_desc": "Avoid idle activated drivers.",
        "lex_workload": "Workload Balancing",
        "lex_workload_desc": "Applied after fixing optimal U and Z.",
        "op_swap": "Equation Swap",
        "op_mult": "Multiply by Constant",
        "op_sum": "Sum Multiple of Equation",
        "lbl_row": "Row",
        "lbl_row_1": "Row 1",
        "lbl_row_2": "Row 2",
        "lbl_base": "Base Row",
        "lbl_target": "Target Row",
        "lbl_const": "Constant",
        "lbl_mult": "Multiplier",
        "btn_bench": "üî¨ Run Academic Benchmark",
        "header_bench": "üéì Comparative Benchmark (Exact vs Heuristic vs LNS)",
        
        # RESULTS
        "res_active_drivers": "Active Drivers",
        "res_assigned_slots": "Assigned Slots",
        "res_service_level": "Service Level",
        "res_opt_gap": "Optimality Gap",
        "msg_no_active": "No active drivers in solution.",
        "msg_opt_error": "Error during optimization:",
        
        # CHARTS
        "chart_effort": "Operational Effort per Driver",
        "chart_heatmap": "Coverage Ratio per Slot",
        "chart_safety": "Safety Margin (Drivers - Demand)",
        "chart_kpi": "KPI Comparison",
        
        # CHART TITLES & LABELS
        "chart_gap_title": "Demand Deficit per Period",
        "chart_gap_total": "Total Deficit",
        "chart_gap_max": "Worst Slot",
        "chart_gap_slots": "Slots with Deficit",
        "chart_gap_yaxis": "Deficit (tasks)",
        
        "chart_demand_served_title": "Demand vs Real Service (per period)",
        "chart_demand_label": "Demand (tasks)",
        "chart_served_label": "Real Service (tasks)",
        "chart_deficit_label": "Deficit",
        
        "chart_cap_util_title": "Allocated Capacity vs Utilization",
        "chart_cap_alloc_label": "Allocated Capacity (tasks)",
        "chart_util_label": "Utilization (0-1)",
        "chart_util_yaxis": "Utilization",
        
        "chart_demand_curve_title": "Demand Curve Over Horizon",
        "chart_demand_req_label": "Required Demand",
        
        "chart_cov_title": "Demand Coverage per Period",
        "chart_drivers_alloc_label": "Allocated Drivers (Capacity)",
        "chart_cov_deficit_label": "Coverage Deficit",
        
        "chart_driv_ecdf_title": "ECDF - Driving (EU)",
        "chart_driv_box_title": "Boxplot - Driving (EU)",
        "chart_driv_xaxis": "Driving Hours",
        
        "chart_shift_ecdf_title": "ECDF - Shift (Presence)",
        "chart_shift_box_title": "Boxplot - Shift (Presence)",
        "chart_shift_xaxis": "Shift Hours",
        
        "chart_gap_cov_title": "Coverage Gap (Drivers - Demand)",
        "chart_gap_cov_yaxis": "Coverage Gap",
        "chart_gap_violations": "Slots with Violation",
        "chart_gap_worst": "Worst Gap",
        
        "chart_dem_cap_util_title": "Demand vs Capacity vs Real Service",
        "chart_util_cap_label": "Capacity Utilization",
        
        "chart_dem_drivers_title": "Demand vs Allocated Drivers",
        "chart_drivers_label": "Allocated Drivers",
        
        "axis_time_hours": "Time (hours)",
        "axis_slot": "Period (slot)",
        "axis_tasks": "Tasks",
        "axis_qty": "Quantity",
        "axis_prob": "Cumulative Proportion",
        "axis_hours": "Hours",
        
        # OPERATIONAL EFFORT CHARTS
        "chart_op_effort_title": "Operational Effort Distribution per Driver",
        "msg_chart_unavailable_matrix": "Chart unavailable: matrix_allocation is None.",
        "msg_chart_invalid_matrix": "Chart unavailable: invalid allocation matrix.",
        "legend_worked_hours": "Worked hours",
        "legend_limit_daily": "Legal daily limit",
        "legend_avg_observed": "Observed average",
        "axis_driver": "Driver",
        "axis_hours_worked_horizon": "Hours worked in horizon",
        "chart_op_effort_active_title": "Operational Effort Distribution ‚Äî Active Drivers",
        "axis_active_drivers_sorted": "Active drivers (sorted by load)",
        "axis_workload_hours": "Workload (hours)",
        "legend_assigned_load": "Assigned load (hours)",
        
        "chart_ecdf_effort_title": "Operational Effort ECDF",
        "chart_dispersion_title": "Effort Dispersion",
        "chart_equity_title": "Operational Effort Equity",
        "legend_lorenz_curve": "Lorenz Curve",
        "legend_equitable_dist": "Equitable distribution",
        "axis_prop_drivers": "Cumulative proportion of drivers",
        "axis_prop_load": "Cumulative proportion of load",
        "axis_total_load_driver": "Total load per driver (h)",
        "panel_effort_title": "Operational Effort Analysis Panel ‚Äî Active Drivers",
        
        "chart_inactive_drivers": "Inactive Drivers",
        "chart_active_drivers": "Active Drivers",
        "axis_assigned_slots": "Assigned slots",
        "axis_num_drivers": "No. of drivers",
        "chart_load_dist_title": "Efficiency - Load Distribution per Driver",

        # OPERATIONAL EFFORT
        "eff_total_slots": "Total assigned slots: {0}",
        "eff_total_hours_simple": "Total work hours: {0:.2f} h",
        "eff_active_drivers": "Active drivers: {0}",
        "eff_avg_effort": "Average effort: {0:.2f} h per driver",
        "eff_note_short": "Note: This indicator represents only\nthe operational effort of the solution,\nnot being the main objective\nof the optimization model.",
        
        "eff_slot_duration": "Slot duration: **{0} minutes**",
        "eff_total_hours_bold": "Total hours worked: **{0:.2f} h**",
        "eff_avg_desc": "On average, each driver worked approximately **{0:.2f} h**,\nconsidering residual flexibility resulting from non-activation of\nminimum daily rest in this scenario.",
        "eff_warning": "‚ö†Ô∏è **Important:** this indicator represents **operational effort**.\nIt is **not the model's objective**, but an emergent result used\nfor efficiency analysis and regulatory validation.",
        "chart_workload_dist_active_title": "Workload Distribution ‚Äî Active Drivers",
        "axis_total_slots_driver": "Total slots assigned to driver",
        "label_assigned_drivers_cap": "Assigned Drivers (Capacity)",
        "label_req_drivers_dem": "Required Drivers (Demand)",
        "label_dem_deficit": "Demand Deficit",
        "chart_dem_cap_viol_title": "Demand vs. Assigned Capacity (Violations Highlighted)",
        "chart_dem_cap_title": "Demand vs. Assigned Capacity",
        "chart_cap_gap_title": "Capacity Gap per Slot",
        "axis_time_slot": "Time Slot",
        "axis_gap_cap_dem": "Gap (Capacity - Demand)",
        "annot_max_deficit": "Max Deficit"
    },
    "pt": {
        # AUTH
        "auth_title": "Acesso Restrito",
        "auth_desc": "Entre com suas credenciais para acessar o simulador.",
        "auth_user": "Usu√°rio",
        "auth_pass": "Senha",
        "auth_error": "üòï Usu√°rio ou senha incorretos",
        "auth_restricted": "üîê Acesso Restrito",

        # MAIN
        "app_title": "Simulador de Aloca√ß√£o de Motoristas",
        "sidebar_nav": "Navega√ß√£o",

        # UI / COMMON
        "loading_opt": "‚è≥ Otimizando escalas... Por favor, aguarde.",
        "run_opt": "Executar Otimiza√ß√£o",
        "global_params": "Par√¢metros Globais",
        "algo_params": "Par√¢metros do Algoritmo",

        # SIMULATION - HEADERS
        "sim_title": "Simula√ß√£o e Otimiza√ß√£o",
        "sect_kpis": "KPIs e M√©tricas",
        "sect_charts": "Gr√°ficos",
        "sect_logs": "Logs do Solver",

        # SIMULATION - INPUTS
        "lbl_horizon": "Horizonte de Planejamento (H)",
        "lbl_slot": "Dura√ß√£o do Slot (min)",
        "lbl_drivers": "N√∫mero de Motoristas (0 = Sem limite)",
        "lbl_obj": "Fun√ß√£o Objetivo",
        "lbl_symmetry": "Habilitar Symmetry Breaking (Mais lento)",
        "lbl_time": "Tempo M√°x (s)",
        "lbl_opt_mode": "Modo de Otimiza√ß√£o",
        "lbl_params": "Par√¢metros",
        "lbl_mode_select": "Selecionar Modo:",
        "lbl_lns_iter": "M√°x Itera√ß√µes LNS",
        "lbl_max_assign": "Maximizar Atribui√ß√£o (Robustez)",
        "lbl_elem_ops": "Opera√ß√µes Elementares",
        "lbl_profile_section": "Perfil",
        "lbl_select_profile": "Selecione um perfil de refer√™ncia (opcional)",
        "sim_main_title": "Simulador",

        # GLOBAL PARAMS COLUMNS
        "col_global": "Global",
        "col_algo": "Algoritmo",
        "col_iter": "Itera√ß√µes | Relaxamento",
        "col_drivers": "Motoristas / Demandas",
        
        # INPUT LABELS
        "lbl_tolerance": "Toler√¢ncia de Cobertura",
        "lbl_variable": "Tipo de Vari√°vel",
        "lbl_solver": "GLOP-LP | SCIP-MIP",
        "lbl_density": "Densidade Aceit√°vel",
        "lbl_limit_iter": "Limite de Itera√ß√µes",
        "lbl_relax": "N√≠vel de Relaxamento",
        "lbl_penalty": "Penalidade por N√£o Atendimento",
        "lbl_cap": "Cap. Tarefas por Motorista/Slot",
        "lbl_set_val": "Fixar Valores",
        "lbl_slot_demand": "Entrada de Demanda por Slot",
        "lbl_total_demand": "Demanda Total Carregada",
        
        # OBJECTIVES & RESTRICTIONS
        "lbl_obj_strat": "Selecione Estrat√©gia de Objetivo",
        "lbl_breakdown": "Detalhamento",
        "lbl_lex_struct": "Estrutura Lexicogr√°fica",
        "lbl_restr": "Restri√ß√µes",
        "lbl_break_opt": "Op√ß√µes de Pausa",
        
        # CACHE & ML
        "lbl_cache": "Cache / Persist√™ncia",
        "lbl_update_file": "Atualizar Arquivo de Restri√ß√µes",
        "lbl_ml_mode": "Modo Machine Learning",
        "lbl_ml_train": "Treinamento ‚Äì Machine Learning",
        "lbl_ml_desc": "Treinar modelos LightGBM (f1 & f2)",
        "btn_train_ml": "Treinar Modelos ML",
        
        # ML MESSAGES & INPUTS
        "ml_train_success_f1": "Modelo f1 treinado com sucesso!",
        "ml_train_fail_f1": "Modelo f1 n√£o foi treinado.",
        "ml_train_success_f2": "Modelo f2 treinado com sucesso!",
        "ml_train_fail_f2": "Modelo f2 n√£o foi treinado.",
        "ml_acc": "Acur√°cia:",
        "ml_mse": "MSE:",
        "ml_na": "n√£o dispon√≠vel.",
        "ml_reason": "Raz√£o n√£o informada.",
        "ml_rows_used": "Linhas usadas:",
        "ml_model_saved": "Modelo salvo em:",
        "ml_res_f1_title": "üìå Modelo f‚ÇÅ (Atribui√ß√£o)",
        "ml_res_f2_title": "üìå Modelo f‚ÇÇ (Ranking de Vizinhan√ßa)",
        "ml_training_start": "Iniciando treinamento... isso pode levar alguns minutos.",
        "ml_training_progress": "Treinando modelos f1 e f2...",
        "ml_training_done": "Treinamento conclu√≠do!",

        "ml_training_error": "Erro durante o treinamento:",

        # ML TRAINER MESSAGES
        "ml_err_lgbm_missing": "LightGBM n√£o est√° instalado no ambiente.",
        "ml_err_dataset_missing": "Dataset {0} n√£o encontrado em: {1}. Gere-o primeiro.",
        "ml_err_dataset_read": "Erro ao ler dataset {0}: {1}",
        "ml_err_dataset_empty": "Dataset {0} est√° vazio. Nenhuma linha para treinar.",
        "ml_err_no_label": "Dataset {0} n√£o cont√©m coluna '{1}'.",
        "ml_err_no_features": "Dataset {0} n√£o possui colunas de features compat√≠veis (esperadas: {1}).",
        "ml_warn_low_data": "Dataset {0} tem poucas linhas ({1}). Modelo pode ficar fraco.",
        "ml_msg_loaded": "Dataset {0} carregado ({1} linhas).",
        "ml_msg_train_success": "Treino conclu√≠do com sucesso.",
        "ml_err_train": "Erro ao treinar LightGBM {0}: {1}",
        "ml_err_acc": "Erro ao calcular acur√°cia de {0}: {1}",
        "ml_err_mse": "Erro ao calcular MSE de {0}: {1}",
        "ml_err_save": "Erro ao salvar modelo {0} em {1}: {2}",
        
        "lbl_num_instances": "N√∫mero de Inst√¢ncias",
        "lbl_periods_per_inst": "Per√≠odos por inst√¢ncia",
        "lbl_drivers_limit": "Motoristas (limite)",
        "lbl_max_periods_driver": "M√°x. per√≠odos por motorista",
        "lbl_min_demand": "Demanda m√≠nima por per√≠odo",
        "lbl_max_demand": "Demanda m√°xima por per√≠odo",
        "lbl_seed": "Semente Aleat√≥ria (Seed)",
        "lbl_f1_desc": "- f‚ÇÅ ‚Üí Modelo de sele√ß√£o de motoristas ‚Äì per√≠odo",
        "lbl_f2_desc": "- f‚ÇÇ ‚Üí Modelo de avalia√ß√£o de vizinhan√ßa para LNS",
        "lbl_dataset_note": "Nota: Inst√¢ncias pequenas s√£o recomendadas para resolver (Exact). (Ex: 24 per√≠odos e 10 motoristas).",
        "btn_gen_dataset": "Gerar Dataset ML (f1 & f2)",
        
        "msg_gen_inst": "Gerando inst√¢ncia {0} de {1}...",
        "msg_solver_error": "Inst√¢ncia {0}: erro ao resolver (Exact) ‚Üí {1}",
        "msg_solver_invalid": "Inst√¢ncia {0}: solver n√£o retornou matriz v√°lida.",
        "msg_norm_fail": "Inst√¢ncia {0}: normaliza√ß√£o falhou. Ignorada.",
        "msg_dataset_success": "Datasets gerados com sucesso!",
        "ml_gen_done": "Conclu√≠do!",
        "ml_gen_success_detail": "Datasets gerados com sucesso!\n\n- f‚ÇÅ: {0} linhas ‚Üí {1}\n- f‚ÇÇ: {2} linhas ‚Üí {3}",
        "ml_dataset_folder": "Pasta dos datasets:",
        "lbl_ml_dataset": "Gerador de Datasets ML",
        "lbl_gen_dataset": "Gerar Datasets de Treino",
        
        # OPTIONS
        "opt_integer": "Inteiro",
        "opt_binary": "Bin√°rio",
        "opt_continuous": "Cont√≠nuo",
        "opt_exact": "Exato",
        "opt_heuristic": "Heur√≠stica",
        "opt_lns": "LNS (Busca em Vizinhan√ßa)",
        "opt_none": "Nenhuma",
        "opt_45_min": "45 minutos",
        "opt_15_30": "Divis√£o 15+30",
        "opt_30_15": "Divis√£o 30+15",
        
        # MATH TERMS
        "math_unmet_penalty": "Penalidade Demanda N√£o Atendida",
        "math_unmet_desc": "Prioridade absoluta: penaliza demanda n√£o atendida.",
        "math_active_penalty": "Penalidade Motoristas Ativos",
        "math_active_desc": "Minimiza a quantidade de motoristas ativos.",
        "math_task_reward": "Recompensa por Tarefa",
        
        # INTERPRETER & ENGINE
        "interp_title": "Interpreta√ß√£o do Resultado",
        "interp_op_eff": "Efici√™ncia Operacional",
        "interp_model_struct": "Estrutura do Modelo",
        "interp_solver_behavior": "Comportamento do Solver",
        "interp_service_quality": "N√≠vel de Servi√ßo / Qualidade",
        "interp_op_effort": "Esfor√ßo Operacional",
        "interp_no_effort": "Nenhum esfor√ßo operacional registrado (0 motoristas ativos).",
        "interp_effort_caption": "Motoristas ativos: **{0}**\nEsfor√ßo m√©dio: **{1:.2f} h**\nMediana: **{2:.2f} h**\nP90 / P95: **{3:.2f} h / {4:.2f} h**\n√çndice de Gini: **{5:.3f}**\n\n‚ö†Ô∏è O painel apresenta indicadores de **esfor√ßo operacional agregado**.\nA refer√™ncia de 9h √© indicativa e n√£o representa, isoladamente,\nverifica√ß√£o direta de conformidade legal.",

        # ENGINE MESSAGES
        "eng_err_interp": "Erro ao interpretar resultados.",
        "eng_opt_proven": "Solu√ß√£o √≥tima comprovada (gap ‚â§ 1%).",
        "eng_opt_likely": "Solu√ß√£o com prova de otimalidade no crit√©rio do solver (gap ~ {0:.2f}% se dispon√≠vel).",
        "eng_feasible": "Solu√ß√£o vi√°vel encontrada, sem prova de otimalidade.",
        "eng_infeasible": "Modelo invi√°vel com as restri√ß√µes atuais.",
        "eng_unknown": "Estado do solver n√£o identificado no resumo.",
        "eng_heuristic_state": "Solu√ß√£o Heur√≠stica (Greedy) - gerada sem solver.",
        "eng_opt_likely": "Solu√ß√£o com prova de otimalidade no crit√©rio do solver (gap ~ {0:.2f}% se dispon√≠vel).",
        "eng_feasible": "Solu√ß√£o vi√°vel encontrada, sem prova de otimalidade.",
        "eng_infeasible": "Modelo invi√°vel com as restri√ß√µes atuais.",
        "eng_unknown": "Estado do solver n√£o identificado no resumo.",
        
        "eng_gap_none": "Gap n√£o informado; avaliar por m√©tricas operacionais e consist√™ncia das restri√ß√µes.",
        "eng_gap_high": "Gap {0:.2f}% (alto): pode haver melhoria consider√°vel com mais tempo.",
        "eng_gap_mod": "Gap {0:.2f}% (moderado): aceit√°vel em opera√ß√£o, mas refin√°vel.",
        "eng_gap_low": "Gap {0:.2f}% (baixo): solu√ß√£o muito boa.",
        
        "eng_model_desc": "Modelo de Programa√ß√£o Inteira Mista (MIP) com vari√°veis bin√°rias de aloca√ß√£o Y[d,t] e vari√°veis de ativa√ß√£o de motorista Z[t].",
        "eng_constr_active": "Total de restri√ß√µes ativas no modelo: {0}.",
        "eng_bnb_desc": "O solver utilizou um algoritmo de Branch-and-Bound com relaxa√ß√µes lineares e heur√≠sticas internas.",
        "eng_opt_reached": "O solver atingiu otimalidade comprovada.",
        "math_task_desc": "Incentiva maior utiliza√ß√£o dos motoristas ativos.",
        "math_presence_min": "Minimiza√ß√£o de Presen√ßa",
        "math_presence_desc": "Reduz tempo de presen√ßa desnecess√°rio.",
        "math_overload": "Balanceamento de Carga",
        "math_overload_desc": "Equilibra carga excessiva por motorista.",
        "math_smoothing": "Suaviza√ß√£o de Carga M√°xima",
        "math_smoothing_desc": "Evita concentra√ß√£o de carga num √∫nico motorista.",
        "math_minimize_drivers": "Minimizar N√∫mero Total de Motoristas",
        "math_role_primary": "Prim√°rio (Fase 1)",
        "math_role_secondary": "Secund√°rio (Fase 1)",
        "math_role_tie": "Desempate",
        "math_role_phase2": "Fase 2",

        # RESTRICTIONS & PROFILES
        "restr_cov_desc": "Necessidade de Cobertura",
        "restr_cov_det": "O n√∫mero de trabalhadores alocados deve satisfazer a demanda m√≠nima do per√≠odo i.",
        "restr_daily_desc": "Limite Di√°rio de Dire√ß√£o",
        "restr_daily_det": "Pode ser 40 per√≠odos (10h) duas vezes por semana.",
        "restr_break45_desc": "Pausa 45min ap√≥s 4.5h",
        "restr_break45_det": "Ap√≥s m√°x. 18 per√≠odos (4.5h), deve haver pausa de 3 per√≠odos (45 min).",
        "restr_rest_daily_desc": "Repouso Di√°rio M√≠nimo",
        "restr_rest_daily_det": "O motorista deve descansar pelo menos 44 per√≠odos (11h) a cada dia.",
        "restr_rest_weekly_desc": "Repouso Semanal",
        "restr_rest_weekly_det": "O motorista deve ter um repouso de 180 per√≠odos (45h) a cada semana.",
        "restr_rest_after_work_desc": "Descanso ap√≥s 6 dias",
        "restr_rest_after_work_det": "O descanso semanal deve ser gozado ap√≥s seis dias consecutivos de trabalho.",
        "restr_weekly_limit_desc": "Limite Semanal de Dire√ß√£o",
        "restr_weekly_limit_det": "O n√∫mero total de per√≠odos de trabalho na semana n√£o pode exceder 224 (56h).",
        "restr_biweekly_limit_desc": "Limite Quinzenal de Dire√ß√£o",
        "restr_biweekly_limit_det": "O n√∫mero total de per√≠odos de trabalho em duas semanas n√£o pode exceder 360 (90h).",
        "restr_rest_reduced_desc": "Repouso Di√°rio Reduzido",
        "restr_rest_reduced_det": "O repouso pode ser reduzido para 36 per√≠odos (9h), m√°x 3 vezes em 14 dias.",
        "restr_rest_biweekly_desc": "Repouso Quinzenal",
        "restr_rest_biweekly_det": "O motorista deve ter um repouso de 96 per√≠odos (24h) a cada duas semanas.",
        
        # PROFILES
        "prof_sanity": "Valida√ß√£o do modelo (cobertura + gr√°ficos, sem regras legais)",
        "prof_operational": "Operacional di√°rio UE (core)",
        "prof_strict": "Operacional di√°rio r√≠gido (repouso m√≠nimo)",
        "prof_flex": "Operacional di√°rio flex√≠vel (repouso reduzido permitido)",
        "prof_weekly_core": "Planejamento semanal (limite semanal)",
        "prof_weekly_strict": "Planejamento semanal r√≠gido (descanso semanal)",
        "prof_biweekly": "Planejamento Quinzenal (Regulamento Completo)",
        "prof_high_demand": "Alta Demanda (Penalidade Agressiva)",
        "prof_low_cost": "Baixo Custo (Aceita gaps para economizar drivers)",

        # DATASET TABLES
        "col_period": "Per√≠odo",
        "col_worker": "Motorista",
        "col_need": "Demanda",
        "col_allocated": "Alocados",
        "col_worker_load": "Carga do Motorista",
        "col_gap": "Gap de Demanda",
        "col_label": "R√≥tulo",
        "col_total_demand": "Demanda Total",
        "col_total_alloc": "Total Alocado",
        "col_uncovered": "N√£o Coberto",
        "col_avg_load": "Carga M√©dia",
        "col_var_load": "Vari√¢ncia de Carga",
        "col_global_cov": "Cobertura Global",
        "col_efficiency": "Efici√™ncia",
        "col_risk": "Risco Operacional",
        "col_stability": "Estabilidade",
        "lbl_preview_f1": "Pr√©-visualiza√ß√£o f1 (Atribui√ß√£o):",
        "lbl_preview_f2": "Pr√©-visualiza√ß√£o f2 (Vizinhan√ßa):",
        
        # LEX OBJECTIVES
        "lex_unmet": "Minimiza√ß√£o de Demanda N√£o Atendida",
        "lex_unmet_desc": "Prioridade absoluta: maximizar cobertura.",
        "lex_driver_min": "Minimiza√ß√£o de Motoristas",
        "lex_driver_desc": "Minimizar n√∫mero de motoristas ativos.",
        "lex_util": "Desempate por Utiliza√ß√£o",
        "lex_util_desc": "Evitar motoristas ativos ociosos.",
        "lex_workload": "Balanceamento de Carga de Trabalho",
        "lex_workload_desc": "Aplicado ap√≥s fixar U e Z √≥timos.",
        "op_swap": "Troca de Equa√ß√µes",
        "op_mult": "Multiplica√ß√£o por Constante",
        "op_sum": "Soma de M√∫ltiplo",
        "lbl_row": "Linha",
        "lbl_row_1": "Linha 1",
        "lbl_row_2": "Linha 2",
        "lbl_base": "Linha Base",
        "lbl_target": "Linha Alvo",
        "lbl_const": "Constante",
        "lbl_mult": "Multiplicador",
        "btn_bench": "üî¨ Executar Benchmark Acad√™mico",
        "header_bench": "üéì Benchmark Comparativo (Exato vs Heur√≠stica vs LNS)",

        # RESULTS
        "res_active_drivers": "Motoristas Ativos",
        "res_assigned_slots": "Slots Alocados",
        "res_service_level": "N√≠vel de Servi√ßo",
        "res_opt_gap": "Gap de Otimalidade",
        "msg_no_active": "Nenhum motorista ativo na solu√ß√£o.",
        "msg_opt_error": "Erro durante a otimiza√ß√£o:",

        # CHARTS
        "chart_effort": "Esfor√ßo Operacional por Motorista",
        "chart_heatmap": "Taxa de Cobertura por Slot",
        "chart_safety": "Margem de Seguran√ßa (Motoristas - Demanda)",
        "chart_kpi": "Compara√ß√£o de KPIs",

        # CHART TITLES & LABELS
        "chart_gap_title": "D√©ficit de Demanda por Per√≠odo",
        "chart_gap_total": "D√©ficit Total",
        "chart_gap_max": "Pior Slot",
        "chart_gap_slots": "Slots com D√©ficit",
        "chart_gap_yaxis": "D√©ficit (tarefas)",
        
        "chart_demand_served_title": "Demanda vs Atendimento Real (por per√≠odo)",
        "chart_demand_label": "Demanda (tarefas)",
        "chart_served_label": "Atendimento Real (tarefas)",
        "chart_deficit_label": "D√©ficit",
        
        "chart_cap_util_title": "Capacidade Alocada vs Utiliza√ß√£o",
        "chart_cap_alloc_label": "Capacidade Alocada (tarefas)",
        "chart_util_label": "Utiliza√ß√£o (0-1)",
        "chart_util_yaxis": "Utiliza√ß√£o",
        
        "chart_demand_curve_title": "Curva de Demanda ao Longo do Horizonte",
        "chart_demand_req_label": "Demanda Requerida",
        
        "chart_cov_title": "Cobertura da Demanda por Per√≠odo",
        "chart_drivers_alloc_label": "Motoristas Alocados (Capacidade)",
        "chart_cov_deficit_label": "D√©ficit de Cobertura",
        
        "chart_driv_ecdf_title": "ECDF ‚Äî Condu√ß√£o (UE)",
        "chart_driv_box_title": "Boxplot ‚Äî Condu√ß√£o (UE)",
        "chart_driv_xaxis": "Horas de Condu√ß√£o",
        
        "chart_shift_ecdf_title": "ECDF ‚Äî Turno (Presen√ßa)",
        "chart_shift_box_title": "Boxplot ‚Äî Turno (Presen√ßa)",
        "chart_shift_xaxis": "Horas de Turno",
        
        "chart_gap_cov_title": "Gap de Cobertura (Motoristas ‚àí Demanda)",
        "chart_gap_cov_yaxis": "Gap de Cobertura",
        "chart_gap_violations": "Slots com Viola√ß√£o",
        "chart_gap_worst": "Pior Gap",
        
        "chart_dem_cap_util_title": "Demanda vs Capacidade vs Atendimento Real",
        "chart_util_cap_label": "Utiliza√ß√£o da Capacidade",
        
        "chart_dem_drivers_title": "Demanda vs Motoristas Alocados",
        "chart_drivers_label": "Motoristas Alocados",
        
        "axis_time_hours": "Tempo (horas)",
        "axis_slot": "Per√≠odo (slot)",
        "axis_tasks": "Tarefas",
        "axis_qty": "Quantidade",
        "axis_prob": "Propor√ß√£o Acumulada",
        "axis_hours": "Horas",
        
        # OPERATIONAL EFFORT CHARTS
        "chart_op_effort_title": "Distribui√ß√£o do Esfor√ßo Operacional por Motorista",
        "msg_chart_unavailable_matrix": "Gr√°fico indispon√≠vel: matrix_allocation √© None.",
        "msg_chart_invalid_matrix": "Gr√°fico indispon√≠vel: matriz de aloca√ß√£o inv√°lida.",
        "legend_worked_hours": "Horas trabalhadas",
        "legend_limit_daily": "Limite di√°rio legal",
        "legend_avg_observed": "M√©dia observada",
        "axis_driver": "Motorista",
        "axis_hours_worked_horizon": "Horas trabalhadas no horizonte",
        "chart_op_effort_active_title": "Distribui√ß√£o do Esfor√ßo Operacional ‚Äî Motoristas Ativos",
        "axis_active_drivers_sorted": "Motoristas ativos (ordenados por carga)",
        "axis_active_drivers_sorted": "Motoristas ativos (ordenados por carga)",
        "axis_workload_hours": "Carga de trabalho (horas)",
        "legend_assigned_load": "Carga atribu√≠da (horas)",
        
        "chart_ecdf_effort_title": "ECDF do Esfor√ßo Operacional",
        "chart_dispersion_title": "Dispers√£o do Esfor√ßo",
        "chart_equity_title": "Equidade do Esfor√ßo Operacional",
        "legend_lorenz_curve": "Curva de Lorenz",
        "legend_equitable_dist": "Distribui√ß√£o equitativa",
        "axis_prop_drivers": "Propor√ß√£o acumulada de motoristas",
        "axis_prop_load": "Propor√ß√£o acumulada da carga",
        "axis_total_load_driver": "Carga total por motorista (h)",
        "panel_effort_title": "Painel de An√°lise do Esfor√ßo Operacional ‚Äî Motoristas Ativos",
        
        "chart_inactive_drivers": "Motoristas Inativos",
        "chart_active_drivers": "Motoristas Ativos",
        "axis_assigned_slots": "Slots atribu√≠dos",
        "axis_num_drivers": "N¬∫ de motoristas",
        "chart_load_dist_title": "Distribui√ß√£o de Carga por Motorista",

        # OPERATIONAL EFFORT
        "eff_total_slots": "Total de slots atribu√≠dos: {0}",
        "eff_total_hours_simple": "Total de horas de trabalho: {0:.2f} h",
        "eff_active_drivers": "Motoristas ativos: {0}",
        "eff_avg_effort": "Esfor√ßo m√©dio: {0:.2f} h por motorista",
        "eff_note_short": "Nota: Este indicador representa apenas\no esfor√ßo operacional da solu√ß√£o,\nn√£o sendo o objetivo principal\ndo modelo de otimiza√ß√£o.",
        
        "eff_slot_duration": "Dura√ß√£o por slot: **{0} minutos**",
        "eff_total_hours_bold": "Total de horas trabalhadas: **{0:.2f} h**",
        "eff_avg_desc": "Em m√©dia, cada motorista trabalhou aproximadamente **{0:.2f} h**.\nconsiderando a flexibilidade residual decorrente da n√£o ativa√ß√£o do\nrepouso di√°rio m√≠nimo neste cen√°rio.",
        "eff_warning": "‚ö†Ô∏è **Importante:** este indicador representa **esfor√ßo operacional**.\nEle **n√£o √© o objetivo do modelo**, mas um resultado emergente utilizado\npara an√°lise de efici√™ncia e valida√ß√£o regulat√≥ria.",
        "chart_workload_dist_active_title": "Distribui√ß√£o da Carga de Trabalho ‚Äî Motoristas Ativos",
        "axis_total_slots_driver": "Total de slots atribu√≠dos ao motorista",
        "label_assigned_drivers_cap": "Motoristas Alocados (Capacidade)",
        "label_req_drivers_dem": "Motoristas Requeridos (Demanda)",
        "label_dem_deficit": "D√©ficit de Demanda",
        "chart_dem_cap_viol_title": "Demanda vs. Capacidade Alocada (Viola√ß√µes Destacadas)",
        "chart_dem_cap_title": "Demanda vs. Capacidade Alocada",
        "chart_cap_gap_title": "Gap de Capacidade por Slot",
        "axis_time_slot": "Slot de Tempo",
        "axis_gap_cap_dem": "Gap (Capacidade - Demanda)",
        "annot_max_deficit": "D√©ficit M√°x"
    },
}

def get_current_lang():
    if "language" not in st.session_state:
        st.session_state["language"] = DEFAULT_LANG
    return st.session_state["language"]

def t(key):
    lang = get_current_lang()
    # Fallback to English if key missing in target lang
    text = TRANSLATIONS.get(lang, {}).get(key)
    if text is None:
        text = TRANSLATIONS.get("en", {}).get(key, key) # Fallback to key itself if missing everywhere
    return text
